## ClassDef ReturnCode
**ReturnCode**: وظيفة ReturnCode هي تمثيل مجموعة من الأكواد التي تُستخدم للإشارة إلى حالات مختلفة من النجاح أو الفشل في عمليات التحقق والتنزيل والتحقق من التوقيعات في المشروع.

**attributes**: السمات الخاصة بهذا الكلاس.
· SUCCESS: يشير إلى نجاح العملية.
· INTEGRITY_FAILURE: يشير إلى فشل في التحقق من سلامة البيانات.
· FILE_GET_FAILED: يشير إلى فشل في الحصول على الملف.
· FILE_MISSING_FROM_ONE_HOST: يشير إلى أن الملف مفقود من أحد المضيفين.
· FILES_NOT_EQUAL: يشير إلى أن الملفات غير متطابقة.
· NO_BINARIES_MATCH: يشير إلى عدم وجود تطابق بين الملفات الثنائية.
· NOT_ENOUGH_GOOD_SIGS: يشير إلى عدم وجود عدد كافٍ من التوقيعات الجيدة.
· BINARY_DOWNLOAD_FAILED: يشير إلى فشل في تنزيل الملف الثنائي.
· BAD_VERSION: يشير إلى أن الإصدار المحدد غير صالح.

**Code Description**: 
ReturnCode هو Enum من النوع IntEnum يُستخدم لتحديد حالات مختلفة يمكن أن تحدث أثناء تنفيذ عمليات التحقق والتنزيل في المشروع. يتم استخدام هذه الأكواد للإشارة إلى نجاح أو فشل العمليات المختلفة، مثل تنزيل الملفات، التحقق من التوقيعات، والتحقق من سلامة البيانات.

في المشروع، يتم استخدام ReturnCode في عدة وظائف مثل `get_files_from_hosts_and_compare`، `verify_shasums_signature`، `verify_binary_hashes`، `verify_published_handler`، و `verify_binaries_handler`. على سبيل المثال، في `get_files_from_hosts_and_compare`، يتم استخدام ReturnCode للإشارة إلى ما إذا كان تنزيل الملفات من المضيفين ناجحًا أو فاشلًا، وما إذا كانت الملفات متطابقة أم لا. في `verify_shasums_signature`، يتم استخدام ReturnCode للإشارة إلى ما إذا كان التحقق من التوقيعات ناجحًا أو فاشلًا، وما إذا كان هناك عدد كافٍ من التوقيعات الجيدة.

**Note**: 
- يجب التأكد من أن الأكواد المستخدمة في ReturnCode يتم التعامل معها بشكل صحيح في الوظائف التي تستدعيها.
- عند استخدام ReturnCode، يجب التحقق من الحالة التي يتم إرجاعها والتعامل معها بشكل مناسب لضمان استمرارية العملية بشكل صحيح.
- يجب أن تكون الأكواد واضحة ومحددة لتسهيل عملية تصحيح الأخطاء وفهم الحالات المختلفة التي يمكن أن تحدث أثناء التنفيذ.
## FunctionDef set_up_logger(is_verbose)
**set_up_logger**: وظيفة `set_up_logger` هي إعداد وتسجيل (logger) يقوم بكتابة الرسائل إلى stderr.

**parameters**: معاملات هذه الوظيفة.
· `is_verbose`: معامل اختياري من نوع boolean، يحدد مستوى تسجيل الرسائل. إذا كان `True`، يتم تعيين مستوى التسجيل إلى `INFO`، وإذا كان `False`، يتم تعيينه إلى `WARNING`. القيمة الافتراضية هي `True`.

**Code Description**: 
تقوم هذه الوظيفة بإعداد وتسجيل (logger) يكتب الرسائل إلى stderr. يتم إنشاء كائن `Logger` باستخدام `logging.getLogger(__name__)`، حيث `__name__` هو اسم الوحدة الحالية. يتم تعيين مستوى التسجيل بناءً على قيمة المعامل `is_verbose`: إذا كانت `True`، يتم تعيين المستوى إلى `INFO`، وإذا كانت `False`، يتم تعيينه إلى `WARNING`.

بعد ذلك، يتم إنشاء معالج (handler) من نوع `StreamHandler` يوجه الرسائل إلى `sys.stderr` (أي إلى stderr). يتم تعيين مستوى هذا المعالج إلى `DEBUG`، مما يعني أنه سيقوم بمعالجة جميع الرسائل بدءًا من مستوى `DEBUG` فما فوق.

يتم بعد ذلك إنشاء `Formatter` لتنسيق الرسائل المسجلة، حيث يتم تعيين التنسيق ليكون `[%(levelname)s] %(message)s`، مما يعني أن كل رسالة ستظهر مع مستوى التسجيل الخاص بها بين أقواس مربعة.

يتم إضافة المعالج إلى الكائن `Logger` باستخدام `log.addHandler(console)`، وأخيرًا يتم إرجاع الكائن `Logger` المعد.

**Note**: 
- تأكد من أنك تقوم باستيراد المكتبات اللازمة (`logging` و `sys`) قبل استخدام هذه الوظيفة.
- يمكن تعديل مستوى التسجيل أو التنسيق حسب الحاجة عن طريق تعديل الكود مباشرة.

**Output Example**: 
عند استدعاء الوظيفة `set_up_logger(is_verbose=True)`، سيتم إرجاع كائن `Logger` معدّ يمكن استخدامه لتسجيل الرسائل. على سبيل المثال، عند استخدام `log.info("هذه رسالة معلومات")`، سيتم طباعة `[INFO] هذه رسالة معلومات` في stderr.
## FunctionDef indent(output)
**indent**: وظيفة `indent` هي إضافة مسافة بادئة (indentation) إلى النص المقدم.  
**parameters**: معاملات هذه الوظيفة.  
· `output`: النص الذي سيتم إضافة المسافة البادئة إليه.  

**Code Description**:  
تقوم هذه الوظيفة باستخدام الدالة `textwrap.indent` من مكتبة `textwrap` القياسية في بايثون لإضافة مسافتين بادئتين (`'  '`) إلى كل سطر من النص المقدم (`output`). يتم استخدام هذه الوظيفة في عدة أماكن داخل المشروع لتحسين عرض النصوص، خاصة عند طباعة النصوص الطويلة أو الفروقات بين الملفات.  

على سبيل المثال، يتم استدعاء هذه الوظيفة في:  
1. `files_are_equal`: لإضافة مسافة بادئة إلى الفروقات بين الملفات قبل طباعتها كتحذير.  
2. `get_files_from_hosts_and_compare`: لإضافة مسافة بادئة إلى ناتج أمر `wget` عند حدوث خطأ في تنزيل الملفات.  
3. `check_multisig`: لإضافة مسافة بادئة إلى ناتج أمر `gpg` عند التحقق من التوقيعات.  
4. `verify_shasums_signature`: لإضافة مسافة بادئة إلى ناتج أمر `gpg` عند فشل التحقق من التوقيعات.  
5. `verify_published_handler`: لإضافة مسافة بادئة إلى ناتج أمر `wget` عند فشل تنزيل الملفات الثنائية.  

**Note**:  
- هذه الوظيفة بسيطة ولا تحتوي على معالجة أخطاء، لذا يجب التأكد من أن النص المقدم (`output`) ليس `None` أو فارغًا.  
- يتم استخدام مسافتين بادئتين (`'  '`) بشكل افتراضي، ويمكن تعديلها إذا لزم الأمر.  

**Output Example**:  
إذا كان النص المدخل هو:  
```
Hello
World
```  
فإن الناتج سيكون:  
```
  Hello
  World
```
## FunctionDef bool_from_env(key, default)
**bool_from_env**: وظيفة `bool_from_env` هي تحويل قيمة متغيرة بيئة (environment variable) إلى قيمة منطقية (boolean) بناءً على محتواها.

**parameters**: معاملات هذه الوظيفة.
· `key`: اسم متغيرة البيئة (environment variable) التي سيتم قراءتها.
· `default`: القيمة الافتراضية التي سيتم إرجاعها في حالة عدم وجود المتغيرة البيئية المحددة. القيمة الافتراضية هي `False`.

**Code Description**: 
تقوم هذه الوظيفة بقراءة قيمة متغيرة بيئة محددة (`key`) من خلال `os.environ`. إذا لم تكن المتغيرة موجودة، يتم إرجاع القيمة الافتراضية (`default`). إذا كانت المتغيرة موجودة، يتم تحويل قيمتها إلى قيمة منطقية بناءً على المحتوى:
- إذا كانت القيمة `1` أو `true` (بغض النظر عن حالة الأحرف)، يتم إرجاع `True`.
- إذا كانت القيمة `0` أو `false` (بغض النظر عن حالة الأحرف)، يتم إرجاع `False`.
- إذا كانت القيمة لا تطابق أيًا من القيم المذكورة أعلاه، يتم إطلاق استثناء (`ValueError`) يشير إلى أن القيمة غير معروفة.

في المشروع، يتم استخدام هذه الوظيفة بشكل متكرر في ملف `dataset/verify.py/main` لتعيين القيم الافتراضية لبعض الخيارات في واجهة سطر الأوامر (CLI). على سبيل المثال، يتم استخدامها لتعيين القيم الافتراضية للخيارات مثل `--verbose`، `--quiet`، `--import-keys`، وغيرها بناءً على متغيرات البيئة مثل `BINVERIFY_VERBOSE`، `BINVERIFY_QUIET`، `BINVERIFY_IMPORTKEYS`.

**Note**: 
- يجب أن تكون قيم متغيرات البيئة إما `1`، `true`، `0`، أو `false` (بغض النظر عن حالة الأحرف) لتجنب إطلاق استثناء.
- إذا كانت القيمة غير معروفة، سيتم إطلاق استثناء `ValueError`.

**Output Example**: 
إذا كانت قيمة متغيرة البيئة `BINVERIFY_VERBOSE` هي `true`، فإن استدعاء `bool_from_env('BINVERIFY_VERBOSE')` سيرجع `True`. إذا كانت القيمة غير موجودة، سيتم إرجاع القيمة الافتراضية `False`.
## FunctionDef parse_version_string(version_str)
**parse_version_string**: وظيفة `parse_version_string` هي تحليل سلسلة الإصدار (version string) إلى مكوناتها الأساسية.  

**parameters**:  
· `version_str`: سلسلة نصية تمثل الإصدار، والتي تحتوي على معلومات مثل الإصدار الأساسي، وإصدار المرشح (rc)، ونظام التشغيل (platform).  

**Code Description**:  
تقوم هذه الوظيفة بتحليل سلسلة الإصدار المدخلة (`version_str`) إلى ثلاثة أجزاء رئيسية:  
1. **الإصدار الأساسي (`version_base`)**: يتم استخراج الجزء الأول من السلسلة قبل الواصلة (`-`).  
2. **إصدار المرشح (`version_rc`)**: إذا كانت السلسلة تحتوي على جزء يشير إلى إصدار مرشح (مثل `rcN`)، يتم استخراجه.  
3. **نظام التشغيل (`version_os`)**: إذا كانت السلسلة تحتوي على جزء يشير إلى نظام التشغيل (مثل `linux` أو `win64`)، يتم استخراجه.  

تعتمد الوظيفة على تقسيم السلسلة باستخدام الواصلة (`-`) كفاصل. يتم تحديد عدد الأجزاء الناتجة عن التقسيم لتحديد ما إذا كانت السلسلة تحتوي على إصدار مرشح أو نظام تشغيل أو كليهما.  

في المشروع، يتم استدعاء هذه الوظيفة من خلال `verify_published_handler` لتحليل سلسلة الإصدار المقدمة كوسيطة (`args.version`). يتم استخدام النتائج (`version_base`, `version_rc`, `version_os`) لتحديد المسار البعيد (`remote_dir`) لتنزيل الملفات والتحقق منها.  

**Note**:  
- يجب أن تكون سلسلة الإصدار بتنسيق محدد، مثل `<version>-rcN-platform` أو `<version>-platform` أو `<version>-rcN`.  
- إذا كانت السلسلة غير متوافقة مع التنسيق المتوقع، قد يؤدي ذلك إلى أخطاء في التحليل.  

**Output Example**:  
إذا كانت سلسلة الإصدار المدخلة هي `22.0-rc1-linux`، فإن القيم المرجعة ستكون:  
```python
("22.0", "rc1", "linux")
```
## FunctionDef download_with_wget(remote_file, local_file)
**download_with_wget**: وظيفة `download_with_wget` هي تنزيل ملف من عنوان URL معين وحفظه في مسار محلي باستخدام أداة `wget`.

**parameters**: معاملات هذه الوظيفة.
· `remote_file`: عنوان URL للملف الذي سيتم تنزيله.
· `local_file`: المسار المحلي حيث سيتم حفظ الملف بعد التنزيل.

**Code Description**: 
تقوم هذه الوظيفة بتنفيذ أمر `wget` عبر وحدة `subprocess` لتنزيل ملف من عنوان URL محدد (`remote_file`) وحفظه في مسار محلي (`local_file`). يتم استخدام الأمر `wget` مع الخيار `-O` لتحديد اسم الملف المحلي الذي سيتم حفظ البيانات فيه. يتم توجيه `stderr` إلى `stdout` لالتقاط أي أخطاء أو رسائل من `wget`، ويتم التقاط `stdout` في متغير `result.stdout` لاستخدامه لاحقًا.

بعد تنفيذ الأمر، تقوم الوظيفة بالتحقق من `returncode` للتحقق مما إذا كانت العملية ناجحة (أي أن `returncode` يساوي 0). إذا كانت العملية ناجحة، تقوم الوظيفة بإرجاع `True` مع الرسالة الناتجة من `wget` بعد إزالة أي مسافات بيضاء زائدة من النهاية. إذا فشلت العملية، يتم إرجاع `False` مع الرسالة الناتجة.

في المشروع، يتم استدعاء هذه الوظيفة من قبل وظيفتين رئيسيتين:
1. `get_files_from_hosts_and_compare`: تستخدم هذه الوظيفة `download_with_wget` لتنزيل ملفات من عدة مضيفات ومقارنة محتوياتها. يتم استخدامها للتحقق من أن الملفات متطابقة عبر المضيفات المختلفة.
2. `verify_published_handler`: تستخدم هذه الوظيفة `download_with_wget` لتنزيل الملفات الثنائية وملفات التوقيعات من مضيفات محددة للتحقق من صحتها وتكاملها.

**Note**: 
- يجب التأكد من أن أداة `wget` مثبتة على النظام قبل استخدام هذه الوظيفة.
- في حالة فشل التنزيل، يتم إرجاع رسالة الخطأ من `wget`، والتي يمكن استخدامها لتشخيص المشكلة.

**Output Example**: 
إذا نجح التنزيل، قد يكون الإرجاع كالتالي:
```python
(True, "File downloaded successfully.")
```
إذا فشل التنزيل، قد يكون الإرجاع كالتالي:
```python
(False, "Failed to resolve host name.")
```
## FunctionDef download_lines_with_urllib(url)
**download_lines_with_urllib**: وظيفة `download_lines_with_urllib` هي تنزيل سطور نصية من ملف عبر HTTP باستخدام مكتبة `urllib`.

**parameters**: معاملات هذه الوظيفة.
· `url`: عنوان URL للملف المطلوب تنزيله.

**Code Description**: 
تقوم هذه الوظيفة بتنزيل سطور نصية من ملف موجود على الويب عبر بروتوكول HTTP باستخدام مكتبة `urllib`. الوظيفة تحاول فتح الرابط المحدد باستخدام `urllib.request.urlopen`، ثم تقرأ جميع السطور من الملف وتعيدها كقائمة من السلاسل النصية بعد إزالة الفراغات الزائدة من كل سطر باستخدام `strip()`. إذا نجحت العملية، تعيد الوظيفة `True` مع قائمة السطور النصية.

في حالة حدوث خطأ أثناء الطلب، مثل خطأ HTTP (مثل 404 أو 500)، يتم التقاط الخطأ باستخدام `urllib.error.HTTPError`، ويتم تسجيل تحذير يحتوي على تفاصيل الخطأ. إذا حدث أي خطأ آخر غير متوقع، يتم التقاطه باستخدام `Exception`، ويتم أيضًا تسجيل تحذير يحتوي على تفاصيل الخطأ. في كلتا الحالتين، تعيد الوظيفة `False` مع قائمة فارغة.

**Note**: 
- تأكد من أن الرابط المقدم (`url`) صالح ويشير إلى ملف نصي يمكن الوصول إليه عبر HTTP.
- يتم تسجيل أي أخطاء تحدث أثناء الطلب في السجل (`log`) باستخدام مستوى التحذير (`warning`)، مما يساعد في تصحيح الأخطاء لاحقًا.

**Output Example**: 
مثال على القيمة التي يمكن أن تعيدها الوظيفة:
```python
(True, ["السطر الأول من الملف", "السطر الثاني من الملف", "السطر الثالث من الملف"])
```
أو في حالة فشل الطلب:
```python
(False, [])
```
## FunctionDef verify_with_gpg(filename, signature_filename, output_filename)
**verify_with_gpg**: وظيفة `verify_with_gpg` هي التحقق من صحة ملف باستخدام توقيع GPG.

**parameters**: معاملات هذه الوظيفة.
· `filename`: اسم الملف الذي سيتم التحقق من صحته.
· `signature_filename`: اسم ملف التوقيع المستخدم للتحقق.
· `output_filename`: اسم الملف الذي سيتم حفظ النتيجة فيه (اختياري، القيمة الافتراضية هي `None`).

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من صحة ملف معين باستخدام توقيع GPG. يتم ذلك عن طريق استدعاء أمر `gpg` من خلال `subprocess.run` مع مجموعة من الوسائط التي تشمل اسم الملف، اسم ملف التوقيع، وخيارات التحقق. يتم إنشاء ملف مؤقت باستخدام `tempfile.NamedTemporaryFile` لتخزين حالة التحقق التي يتم قراءتها لاحقًا.

الوظيفة تقوم بتعيين لغة البيئة إلى الإنجليزية (`LANGUAGE='en'`) لضمان أن تكون النتائج باللغة الإنجليزية. بعد تنفيذ الأمر، يتم قراءة البيانات من الملف المؤقت وفك تشفيرها للحصول على معلومات التحقق. يتم تسجيل النتائج باستخدام `log.debug` لعرضها لأغراض التصحيح.

يتم استخدام هذه الوظيفة في `check_multisig` للتحقق من صحة ملف يحتوي على توقيعات متعددة. في حالة وجود توقيعات غير معروفة، يتم استيراد المفاتيح المطلوبة وإعادة التحقق مرة أخرى.

**Note**: 
- يجب أن يكون `gpg` مثبتًا على النظام حتى تعمل هذه الوظيفة بشكل صحيح.
- في حالة عدم تحديد `output_filename`، لن يتم حفظ النتيجة في ملف.
- يتم تسجيل النتائج باستخدام `log.debug`، لذا يجب تفعيل مستوى التصحيح لرؤية هذه الرسائل.

**Output Example**: 
مثال على القيمة المرجعة:
```python
(0, "VERIFICATION SUCCESS")
```
حيث `0` هو رمز الخروج من `gpg`، و`"VERIFICATION SUCCESS"` هي الرسالة التي تشير إلى نجاح عملية التحقق.
## FunctionDef remove_files(filenames)
**remove_files**: وظيفة `remove_files` هي حذف ملفات محددة من النظام.

**parameters**: معاملات هذه الوظيفة.
· `filenames`: قائمة تحتوي على أسماء الملفات التي يراد حذفها. يجب أن تكون أسماء الملفات عبارة عن سلاسل نصية (strings) تمثل المسارات الكاملة للملفات.

**Code Description**: 
تقوم هذه الوظيفة بحذف ملفات محددة من النظام باستخدام حلقة `for` للتكرار عبر قائمة أسماء الملفات (`filenames`). لكل اسم ملف في القائمة، يتم استدعاء الدالة `os.remove(filename)` التي تقوم بحذف الملف المحدد من نظام الملفات. يتم تنفيذ هذه العملية لكل ملف في القائمة حتى يتم حذف جميع الملفات المطلوبة.

**Note**: 
- يجب التأكد من أن أسماء الملفات المقدمة في القائمة صحيحة وأن المستخدم لديه الصلاحيات الكافية لحذف هذه الملفات.
- في حالة وجود ملف غير موجود أو غير قابل للحذف، سيتم رفع استثناء (exception) من قبل نظام التشغيل، لذا يُفضل التعامل مع هذه الحالات باستخدام `try-except` لتجنب توقف البرنامج بشكل غير متوقع.
- يُنصح باستخدام هذه الوظيفة بحذر لتجنب حذف ملفات مهمة عن طريق الخطأ.
## ClassDef SigData
**SigData**: وظيفة SigData هي تمثيل بيانات التوقيع التي تم تحليلها من ناتج GPG (GNU Privacy Guard).

**attributes**: السمات الخاصة بهذا الكلاس.
· `key`: المفتاح العام للتوقيع، وقد يكون `None` إذا لم يتم تعيينه.
· `name`: اسم الموقع، ويتم تعيينه كسلسلة نصية فارغة بشكل افتراضي.
· `trusted`: قيمة منطقية تشير إلى ما إذا كان التوقيع موثوقًا به أم لا، وتكون `False` بشكل افتراضي.
· `status`: حالة التوقيع، مثل "منتهي الصلاحية" أو "ملغى"، وتكون سلسلة نصية فارغة بشكل افتراضي.

**Code Description**: 
يُستخدم هذا الكلاس لتمثيل بيانات التوقيع التي يتم استخراجها من ناتج GPG. يحتوي الكلاس على أربع سمات رئيسية: `key` (المفتاح العام)، `name` (اسم الموقع)، `trusted` (ما إذا كان التوقيع موثوقًا به)، و`status` (حالة التوقيع). يتم استخدام هذه السمات لتخزين المعلومات المتعلقة بالتوقيعات التي يتم تحليلها من ناتج GPG.

يحتوي الكلاس أيضًا على دالة `__bool__` التي تُستخدم للتحقق مما إذا كان المفتاح (`key`) قد تم تعيينه أم لا. إذا كان المفتاح غير `None`، فإن الكائن يعتبر صحيحًا (`True`)، وإلا فإنه يعتبر خاطئًا (`False`). بالإضافة إلى ذلك، يحتوي الكلاس على دالة `__repr__` التي تُستخدم لتمثيل الكائن كسلسلة نصية عند طباعته أو تحويله إلى سلسلة نصية.

في المشروع، يتم استخدام هذا الكلاس بشكل رئيسي في الدالة `parse_gpg_result`، حيث يتم تحليل ناتج GPG وتصنيف التوقيعات إلى ثلاث فئات: `good_sigs` (التوقيعات الجيدة)، `unknown_sigs` (التوقيعات غير المعروفة)، و`bad_sigs` (التوقيعات السيئة). يتم إنشاء كائنات من نوع `SigData` لتخزين معلومات كل توقيع، ثم يتم إضافتها إلى القائمة المناسبة بناءً على حالة التوقيع.

**Note**: 
- يجب التأكد من أن المفتاح (`key`) يتم تعيينه بشكل صحيح قبل استخدام الكائن في أي عمليات تحقق.
- يمكن استخدام الدالة `__bool__` للتحقق من صحة الكائن قبل إضافته إلى أي قائمة.

**Output Example**: 
مثال على تمثيل كائن من نوع `SigData`:
```python
SigData('ABC123', 'John Doe', trusted=True, status='')
```
في هذا المثال، المفتاح هو `'ABC123'`، واسم الموقع هو `'John Doe'`، والتوقيع موثوق به (`trusted=True`)، ولا توجد حالة خاصة (`status=''`).
### FunctionDef __init__(self)
**__init__**: وظيفة `__init__` هي تهيئة كائن من الفئة `SigData` وتعيين القيم الافتراضية لخصائصه.

**parameters**: لا تحتوي هذه الدالة على أي معاملات (parameters).

**Code Description**: 
تقوم دالة `__init__` بتهيئة كائن من الفئة `SigData` عند إنشائه. يتم تعيين القيم الافتراضية للخصائص التالية:
- `self.key`: يتم تعيينه إلى `None`، مما يعني أنه لا توجد قيمة مبدئية لهذا المفتاح.
- `self.name`: يتم تعيينه إلى سلسلة نصية فارغة `""`، مما يشير إلى عدم وجود اسم مبدئي.
- `self.trusted`: يتم تعيينه إلى `False`، مما يعني أن الكائن غير موثوق به بشكل افتراضي.
- `self.status`: يتم تعيينه إلى سلسلة نصية فارغة `""`، مما يشير إلى عدم وجود حالة مبدئية.

**Note**: 
- هذه الدالة لا تأخذ أي معاملات، وتقوم فقط بتهيئة الخصائص الداخلية للكائن بقيم افتراضية.
- يمكن تعديل هذه الخصائص لاحقًا بعد إنشاء الكائن حسب الحاجة.
***
### FunctionDef __bool__(self)
**__bool__**: وظيفة __bool__ هي تحديد ما إذا كان الكائن صحيحًا (True) أو خاطئًا (False) بناءً على قيمة المفتاح (key).

**parameters**: لا تحتوي هذه الدالة على أي معاملات (parameters).

**Code Description**: تقوم هذه الدالة بإرجاع قيمة منطقية (boolean) تعتمد على ما إذا كانت الخاصية `key` للكائن الحالي تحتوي على قيمة غير `None`. إذا كانت `key` تحتوي على قيمة غير `None`، فإن الدالة ترجع `True`، مما يشير إلى أن الكائن صحيح. وإذا كانت `key` تساوي `None`، فإن الدالة ترجع `False`، مما يشير إلى أن الكائن خاطئ.

**Note**: يجب التأكد من أن الخاصية `key` تمت تهيئتها بشكل صحيح قبل استخدام هذه الدالة، حيث أن الدالة تعتمد بشكل كامل على قيمة `key` لتحديد النتيجة.

**Output Example**: إذا كانت `key` تحتوي على قيمة مثل `123`، فإن الدالة سترجع `True`. إذا كانت `key` تساوي `None`، فإن الدالة سترجع `False`.
***
### FunctionDef __repr__(self)
**__repr__**: وظيفة `__repr__` هي إرجاع تمثيل نصي (string representation) للكائن `SigData` بشكل يمكن استخدامه لإعادة إنشاء الكائن أو لفهم محتوياته بسهولة.

**parameters**: لا تحتوي هذه الدالة على أي معاملات (parameters) إضافية بخلاف الكائن نفسه (`self`).

**Code Description**: تقوم الدالة `__repr__` بإرجاع سلسلة نصية (string) تمثل الكائن `SigData`. تحتوي هذه السلسلة على معلومات حول الخصائص الأساسية للكائن، وهي:
- `self.key`: المفتاح (key) المرتبط بالكائن.
- `self.name`: الاسم (name) المرتبط بالكائن.
- `self.trusted`: قيمة منطقية (boolean) تشير إلى ما إذا كان الكائن موثوقًا أم لا.
- `self.status`: الحالة (status) الحالية للكائن.

يتم استخدام التنسيق `%r` لضمان أن القيم المعروضة تكون في شكلها الخام (raw representation)، مما يسهل فهمها وإعادة استخدامها. يتم بناء السلسلة النصية باستخدام التنسيق `"SigData(%r, %r, trusted=%s, status=%r)"`، حيث يتم استبدال الرموز النسبية (`%r` و `%s`) بالقيم الفعلية للخصائص المذكورة.

**Note**: 
- يُفضل استخدام `__repr__` عند الحاجة إلى تمثيل الكائن بشكل يمكن قراءته بواسطة المطورين أو عند الحاجة إلى إعادة إنشاء الكائن.
- يجب أن تكون السلسلة النصية المُرجعة واضحة ودقيقة لتمثيل الكائن بشكل صحيح.

**Output Example**: 
إذا كانت قيم الخصائص كالتالي:
- `self.key = "example_key"`
- `self.name = "example_name"`
- `self.trusted = True`
- `self.status = "active"`

فإن الناتج سيكون:
```
SigData('example_key', 'example_name', trusted=True, status='active')
```
***
## FunctionDef parse_gpg_result(output)
**parse_gpg_result**: وظيفة `parse_gpg_result` هي تحليل ناتج GPG (GNU Privacy Guard) وتصنيف التوقيعات إلى ثلاث فئات: توقيعات جيدة، توقيعات غير معروفة، وتوقيعات سيئة.

**parameters**: معاملات هذه الوظيفة.
· `output`: قائمة من السلاسل النصية (`List[str]`) تمثل ناتج GPG الذي يتم تحليله.

**Code Description**: 
تقوم هذه الوظيفة بتحليل ناتج GPG الذي يتم تمريره كقائمة من السلاسل النصية (`output`). يتم تصنيف التوقيعات إلى ثلاث فئات رئيسية بناءً على المعلومات الموجودة في الناتج:
1. **التوقيعات الجيدة (`good_sigs`)**: التوقيعات التي تم التحقق منها بنجاح وتعتبر موثوقة.
2. **التوقيعات غير المعروفة (`unknown_sigs`)**: التوقيعات التي لا يمكن التحقق منها بسبب عدم وجود المفتاح العام في قاعدة بيانات GPG المحلية.
3. **التوقيعات السيئة (`bad_sigs`)**: التوقيعات التي فشل التحقق منها أو تم اعتبارها غير صالحة.

تعمل الوظيفة من خلال قراءة كل سطر من ناتج GPG وتحديد نوع التوقيع بناءً على البادئات الموجودة في السطر. على سبيل المثال:
- إذا بدأ السطر بـ `GOODSIG`، يتم اعتبار التوقيع جيدًا ويتم تخزين معلوماته في كائن من نوع `SigData` وإضافته إلى قائمة `good_sigs`.
- إذا بدأ السطر بـ `BADSIG`، يتم اعتبار التوقيع سيئًا ويتم إضافته إلى قائمة `bad_sigs`.
- إذا بدأ السطر بـ `ERRSIG`، يتم اعتبار التوقيع غير معروف ويتم إضافته إلى قائمة `unknown_sigs`.

بالإضافة إلى ذلك، تقوم الوظيفة بجمع معلومات إضافية مثل حالة التوقيع (مثل "منتهي الصلاحية" أو "ملغى") وما إذا كان التوقيع موثوقًا به أم لا.

في نهاية العملية، يتم التحقق من أن عدد التوقيعات التي تم تحليلها يتطابق مع العدد المتوقع. إذا كان هناك عدم تطابق، يتم إطلاق استثناء (`RuntimeError`).

**Note**: 
- يجب أن يكون ناتج GPG الممرر إلى الوظيفة في شكل قائمة من السلاسل النصية، حيث يمثل كل سطر جزءًا من الناتج.
- يتم استخدام كائنات من نوع `SigData` لتخزين معلومات كل توقيع، ويجب التأكد من أن هذه الكائنات تحتوي على المعلومات الصحيحة قبل استخدامها في أي عمليات لاحقة.

**Output Example**: 
مثال على القيمة المرجعة من الوظيفة:
```python
(
    [SigData('ABC123', 'John Doe', trusted=True, status='')],  # good_sigs
    [SigData('XYZ456', 'Jane Doe', trusted=False, status='')], # unknown_sigs
    [SigData('DEF789', 'Unknown', trusted=False, status='')]   # bad_sigs
)
```
في هذا المثال، تم تحليل ثلاثة توقيعات: توقيع جيد واحد، وتوقيع غير معروف واحد، وتوقيع سيء واحد.
### FunctionDef line_begins_with(patt, line)
**line_begins_with**: وظيفة `line_begins_with` هي التحقق مما إذا كان السطر المحدد يبدأ بنمط معين مسبوقًا بعلامة `[GNUPG:]`.

**parameters**: معاملات هذه الوظيفة.
· `patt`: النمط (pattern) الذي تريد التحقق من بدء السطر به. يجب أن يكون من النوع `str`.
· `line`: السطر الذي تريد التحقق منه. يجب أن يكون من النوع `str`.

**Code Description**: تقوم هذه الوظيفة بالتحقق مما إذا كان السطر المحدد (`line`) يبدأ بالنمط المحدد (`patt`) مسبوقًا بعلامة `[GNUPG:]` ومسافة بيضاء. يتم ذلك باستخدام التعبير النمطي (regex) الذي يبدأ بـ `^(\[GNUPG:\])\s+` متبوعًا بالنمط المحدد (`patt`). إذا تطابق السطر مع هذا النمط، تقوم الوظيفة بإرجاع كائن `re.Match` الذي يمثل التطابق. إذا لم يتطابق السطر مع النمط، تقوم الوظيفة بإرجاع `None`.

**Note**: 
- يجب أن يكون النمط (`patt`) جزءًا من التعبير النمطي الذي يتم التحقق منه بعد `[GNUPG:]`.
- إذا كان السطر لا يبدأ بـ `[GNUPG:]` متبوعًا بالنمط المحدد، فإن الوظيفة سترجع `None`.

**Output Example**: 
إذا كان السطر هو `[GNUPG:] GOODSIG 1234567890ABCDEF` والنمط المحدد هو `GOODSIG`، فإن الوظيفة سترجع كائن `re.Match` الذي يمثل التطابق. إذا كان السطر لا يبدأ بالنمط المحدد، سترجع الوظيفة `None`.
***
## FunctionDef files_are_equal(filename1, filename2)
**files_are_equal**: وظيفة `files_are_equal` هي مقارنة محتويات ملفين لتحديد ما إذا كانا متطابقين أم لا.  

**parameters**: معاملات هذه الوظيفة.  
· `filename1`: اسم الملف الأول الذي سيتم مقارنته.  
· `filename2`: اسم الملف الثاني الذي سيتم مقارنته.  

**Code Description**:  
تقوم هذه الوظيفة بمقارنة محتويات ملفين (`filename1` و `filename2`) لتحديد ما إذا كانا متطابقين. يتم ذلك عن طريق فتح الملفين في وضع القراءة الثنائية (`'rb'`) وقراءة محتوياتهما كاملة. إذا كانت المحتويات متطابقة، تقوم الوظيفة بإرجاع `True`.  

في حالة عدم التطابق، تقوم الوظيفة بفتح الملفين مرة أخرى ولكن هذه المرة في وضع القراءة النصية (`'r'`) باستخدام ترميز `utf-8`. يتم قراءة جميع الأسطر من كلا الملفين واستخدام مكتبة `difflib` لتوليد فروقات موحدة (`unified_diff`) بين الملفين. يتم بعد ذلك إضافة مسافة بادئة إلى هذه الفروقات باستخدام وظيفة `indent` لتحسين عرضها، ويتم تسجيل تحذير (`log.warning`) يحتوي على الفروقات بين الملفين.  

تستخدم هذه الوظيفة في المشروع بشكل رئيسي في وظيفة `get_files_from_hosts_and_compare` لمقارنة الملفات التي تم تنزيلها من مضيفات مختلفة. إذا كانت الملفات غير متطابقة، يتم تسجيل خطأ (`log.error`) وإرجاع رمز خطأ `ReturnCode.FILES_NOT_EQUAL`.  

**Note**:  
- يجب التأكد من أن الملفات المقدمة (`filename1` و `filename2`) موجودة وقابلة للقراءة قبل استدعاء هذه الوظيفة.  
- يتم استخدام ترميز `utf-8` لقراءة الملفات نصيًا، لذا يجب أن تكون الملفات متوافقة مع هذا الترميز.  
- في حالة وجود فروقات بين الملفات، يتم تسجيلها كتحذير (`warning`) وليس كخطأ (`error`)، مما يسمح بالاستمرار في التنفيذ مع إعلام المستخدم بالفروقات.  

**Output Example**:  
إذا كان الملفان متطابقين، فإن الناتج سيكون:  
```
True
```  
إذا كان الملفان غير متطابقين، فإن الناتج سيكون:  
```
False
```  
وسيتم تسجيل تحذير يحتوي على الفروقات بين الملفين، على سبيل المثال:  
```
found diff in files (file1.txt, file2.txt):
  --- file1.txt
  +++ file2.txt
  @@ -1,3 +1,3 @@
   Hello
  -World
  +Python
```
## FunctionDef get_files_from_hosts_and_compare(hosts, path, filename, require_all)
**get_files_from_hosts_and_compare**: وظيفة `get_files_from_hosts_and_compare` هي استرداد نفس الملف من عدة مضيفات والتحقق من أن محتوياتها متطابقة. يتم التعامل مع المضيف الأول على أنه المضيف "الرئيسي"، ويجب أن ينجح تنزيل الملف منه.

**parameters**: معاملات هذه الوظيفة.
· `hosts`: قائمة تحتوي على عناوين المضيفين التي سيتم تنزيل الملف منها.
· `path`: المسار على المضيف حيث يوجد الملف المطلوب تنزيله.
· `filename`: اسم الملف الذي سيتم حفظه محليًا بعد التنزيل.
· `require_all`: معامل اختياري (افتراضيًا `False`) يحدد ما إذا كان يجب أن ينجح تنزيل الملف من جميع المضيفين أم لا.

**Code Description**: 
تقوم هذه الوظيفة بتنزيل نفس الملف من عدة مضيفات والتحقق من أن محتوياتها متطابقة. يتم التعامل مع المضيف الأول في القائمة (`hosts[0]`) على أنه المضيف الرئيسي، ويجب أن ينجح تنزيل الملف منه. إذا فشل التنزيل من المضيف الرئيسي، يتم إرجاع رمز الخطأ `ReturnCode.FILE_GET_FAILED`. 

بعد ذلك، يتم تنزيل الملف من المضيفين الآخرين. إذا تم تعيين المعامل `require_all` على `True` وفشل تنزيل الملف من أي مضيف، يتم إرجاع رمز الخطأ `ReturnCode.FILE_MISSING_FROM_ONE_HOST`. إذا لم يتم تعيين `require_all` على `True`، يتم الاستمرار في العملية مع تسجيل تحذير فقط.

بعد تنزيل الملفات من جميع المضيفين، يتم مقارنة محتوياتها باستخدام وظيفة `files_are_equal`. إذا كانت الملفات غير متطابقة، يتم إرجاع رمز الخطأ `ReturnCode.FILES_NOT_EQUAL`. إذا كانت جميع الملفات متطابقة، يتم إرجاع رمز النجاح `ReturnCode.SUCCESS`.

يتم استخدام هذه الوظيفة في المشروع بشكل رئيسي في وظيفة `verify_published_handler` لتنزيل ملفات التوقيعات (`SIGNATUREFILENAME`) وملفات المجاميع (`SUMS_FILENAME`) من عدة مضيفات والتحقق من أن محتوياتها متطابقة. يتم استخدام هذه الوظيفة أيضًا للتحقق من أن الملفات التي تم تنزيلها من المضيفين المختلفة متطابقة، مما يضمن سلامة البيانات وتكاملها.

**Note**: 
- يجب أن تحتوي القائمة `hosts` على أكثر من مضيف واحد، حيث يتم التعامل مع المضيف الأول على أنه المضيف الرئيسي.
- إذا تم تعيين `require_all` على `True`، يجب أن ينجح تنزيل الملف من جميع المضيفين، وإلا سيتم إرجاع رمز خطأ.
- يتم استخدام وظيفة `download_with_wget` لتنزيل الملفات من المضيفين، ويتم استخدام وظيفة `files_are_equal` لمقارنة محتويات الملفات.

**Output Example**: 
إذا نجح تنزيل الملفات من جميع المضيفين وكانت محتوياتها متطابقة، فإن الناتج سيكون:
```
ReturnCode.SUCCESS
```
إذا فشل تنزيل الملف من المضيف الرئيسي، فإن الناتج سيكون:
```
ReturnCode.FILE_GET_FAILED
```
إذا كانت الملفات غير متطابقة، فإن الناتج سيكون:
```
ReturnCode.FILES_NOT_EQUAL
```
### FunctionDef join_url(host)
**join_url**: وظيفة `join_url` هي دمج عنوان URL الأساسي مع مسار معين لإنتاج عنوان URL كامل.

**parameters**: معاملات هذه الوظيفة.
· `host`: عبارة عن سلسلة نصية (string) تمثل الجزء الأساسي من عنوان URL، مثل "https://example.com".

**Code Description**: تقوم هذه الوظيفة بدمج الجزء الأساسي من عنوان URL (`host`) مع مسار معين (`path`) لإنتاج عنوان URL كامل. يتم أولاً إزالة أي شرطة مائلة (`/`) زائدة من نهاية الجزء الأساسي (`host`) باستخدام الدالة `rstrip('/')`. ثم يتم إضافة شرطة مائلة واحدة (`/`) متبوعة بالمسار (`path`) بعد إزالة أي شرطة مائلة زائدة من بداية المسار باستخدام الدالة `lstrip('/')`. النتيجة هي عنوان URL كامل بدون شرط مائلة زائدة في المنتصف أو في النهاية.

**Note**: 
- يجب أن يكون المتغير `path` معرفًا ومتاحًا في النطاق الذي يتم فيه استدعاء هذه الوظيفة.
- إذا كان `host` يحتوي على شرطة مائلة في النهاية، سيتم إزالتها قبل الدمج.
- إذا كان `path` يحتوي على شرطة مائلة في البداية، سيتم إزالتها قبل الدمج.

**Output Example**: 
إذا كان `host` هو "https://example.com" و `path` هو "/api/data"، فإن الناتج سيكون:
```
https://example.com/api/data
```
***
## FunctionDef check_multisig(sums_file, sigfilename, args)
**check_multisig**: وظيفة `check_multisig` هي التحقق من صحة ملف باستخدام توقيعات متعددة (multisig) باستخدام GPG.

**parameters**: معاملات هذه الوظيفة.
· `sums_file`: اسم الملف الذي يحتوي على المجاميع (checksums) التي سيتم التحقق منها.
· `sigfilename`: اسم ملف التوقيع الذي سيتم استخدامه للتحقق.
· `args`: كائن من نوع `argparse.Namespace` يحتوي على خيارات إضافية مثل `verbose` و`import_keys`.

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من صحة ملف باستخدام توقيعات متعددة (multisig) باستخدام GPG. يتم ذلك عن طريق استدعاء وظيفة `verify_with_gpg` التي تقوم بتنفيذ أمر GPG للتحقق من التوقيعات. يتم تمرير اسم الملف (`sums_file`) واسم ملف التوقيع (`sigfilename`) كمعاملات لهذه الوظيفة.

بعد تنفيذ أمر GPG، يتم تحليل الناتج باستخدام وظيفة `parse_gpg_result` التي تقوم بتصنيف التوقيعات إلى ثلاث فئات: توقيعات جيدة (`good`)، توقيعات غير معروفة (`unknown`)، وتوقيعات سيئة (`bad`). إذا كانت هناك توقيعات غير معروفة وتم تفعيل خيار `import_keys`، يتم طلب موافقة المستخدم لاسترداد المفاتيح غير المعروفة باستخدام وظيفة `prompt_yn`. في حالة موافقة المستخدم، يتم استرداد المفاتيح من خادم المفاتيح (`keyserver`) وإعادة التحقق من التوقيعات مرة أخرى.

إذا تم تفعيل الخيار `verbose`، يتم عرض ناتج GPG مع إضافة مسافة بادئة باستخدام وظيفة `indent` لتحسين قراءة الناتج.

في النهاية، تقوم الوظيفة بإرجاع رمز الخروج من GPG (`retval`)، الناتج الكامل من GPG (`output`)، وقوائم التوقيعات المصنفة (`good`, `unknown`, `bad`).

**Note**: 
- يجب أن يكون GPG مثبتًا على النظام حتى تعمل هذه الوظيفة بشكل صحيح.
- في حالة وجود توقيعات غير معروفة، يمكن استرداد المفاتيح المطلوبة إذا تم تفعيل خيار `import_keys`.
- يتم استخدام وظيفة `indent` لتحسين عرض الناتج عند تفعيل الخيار `verbose`.

**Output Example**: 
مثال على القيمة المرجعة:
```python
(
    0,  # رمز الخروج من GPG
    "VERIFICATION SUCCESS",  # الناتج الكامل من GPG
    [SigData('ABC123', 'John Doe', trusted=True, status='')],  # توقيعات جيدة
    [SigData('XYZ456', 'Jane Doe', trusted=False, status='')],  # توقيعات غير معروفة
    [SigData('DEF789', 'Unknown', trusted=False, status='')]    # توقيعات سيئة
)
```
## FunctionDef prompt_yn(prompt)
**prompt_yn**: وظيفة `prompt_yn` هي طلب إدخال من المستخدم والتحقق مما إذا كان الإدخال هو الحرف "y" أم لا.

**parameters**: معاملات هذه الوظيفة.
· `prompt`: عبارة نصية تُعرض للمستخدم لطلب إدخال. عادةً ما يكون سؤالًا يطلب من المستخدم الإجابة بـ "y" أو "n".

**Code Description**: 
تقوم هذه الوظيفة بعرض `prompt` للمستخدم وانتظار إدخاله. يتم تكرار طلب الإدخال حتى يقوم المستخدم بإدخال إما "y" أو "n" (بغض النظر عن حالة الأحرف، حيث يتم تحويل الإدخال إلى أحرف صغيرة). إذا كان الإدخال هو "y"، تقوم الوظيفة بإرجاع `True`، وإذا كان الإدخال هو "n"، تقوم بإرجاع `False`.

في المشروع، يتم استدعاء هذه الوظيفة من خلال وظيفة `check_multisig` في ملف `dataset/verify.py`. يتم استخدامها لطلب موافقة المستخدم على استرداد مفتاح غير معروف (unknown key) أثناء عملية التحقق من التوقيعات. على سبيل المثال، إذا كان هناك توقيع غير معروف، يتم عرض رسالة للمستخدم تطلب منه الموافقة على استرداد المفتاح عن طريق إدخال "y" أو "n". إذا أدخل المستخدم "y"، يتم استرداد المفتاح ومحاولة التحقق من التوقيع مرة أخرى.

**Note**: 
- يجب أن يكون الإدخال إما "y" أو "n" فقط. أي إدخال آخر سيؤدي إلى تكرار الطلب.
- الوظيفة لا تقبل سوى إدخال نصي، لذا يجب التأكد من أن `prompt` يكون سلسلة نصية.

**Output Example**: 
إذا أدخل المستخدم "y"، سيكون الإرجاع:
```python
True
```
إذا أدخل المستخدم "n"، سيكون الإرجاع:
```python
False
```
## FunctionDef verify_shasums_signature(signature_file_path, sums_file_path, args)
**verify_shasums_signature**: وظيفة `verify_shasums_signature` هي التحقق من صحة ملف التوقيعات (`signature_file_path`) لملف المجاميع (`sums_file_path`) باستخدام GPG، وتقييم التوقيعات بناءً على المفاتيح الموثوقة والمعايير المحددة.

**parameters**: معاملات هذه الوظيفة.
· `signature_file_path`: مسار ملف التوقيعات الذي سيتم التحقق منه.
· `sums_file_path`: مسار ملف المجاميع (SHA256SUMS) الذي سيتم التحقق من توقيعاته.
· `args`: كائن من نوع `argparse.Namespace` يحتوي على خيارات إضافية مثل `min_good_sigs` (الحد الأدنى للتوقيعات الجيدة المطلوبة) و`trusted_keys` (المفاتيح الموثوقة).

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من صحة ملف التوقيعات (`signature_file_path`) لملف المجاميع (`sums_file_path`) باستخدام GPG. يتم ذلك عن طريق استدعاء وظيفة `check_multisig` التي تقوم بتنفيذ أمر GPG للتحقق من التوقيعات وتصنيفها إلى ثلاث فئات: توقيعات جيدة (`good`)، توقيعات غير معروفة (`unknown`)، وتوقيعات سيئة (`bad`). 

بعد التحقق، يتم تقييم التوقيعات بناءً على المفاتيح الموثوقة (`trusted_keys`) التي يتم تمريرها عبر معامل `args`. يتم تقسيم التوقيعات الجيدة إلى توقيعات موثوقة (`good_trusted`) وتوقيعات غير موثوقة (`good_untrusted`) بناءً على ما إذا كانت المفاتيح الخاصة بها مدرجة في قائمة المفاتيح الموثوقة. 

يتم بعد ذلك التحقق من أن عدد التوقيعات الموثوقة (`num_trusted`) يلبي الحد الأدنى المطلوب (`min_good_sigs`). إذا لم يتم تحقيق هذا الحد، يتم إرجاع رمز خطأ `ReturnCode.NOT_ENOUGH_GOOD_SIGS`. وإذا كان التحقق ناجحًا، يتم إرجاع رمز نجاح `ReturnCode.SUCCESS` مع قوائم التوقيعات المصنفة.

يتم استخدام هذه الوظيفة في وظيفتين رئيسيتين في المشروع: `verify_published_handler` و`verify_binaries_handler`. في كلتا الحالتين، يتم استخدامها للتحقق من صحة ملفات التوقيعات الخاصة بملفات المجاميع قبل تنفيذ عمليات التحقق الأخرى مثل تحقق من الهاشات أو تنزيل الملفات الثنائية.

**Note**: 
- يجب أن يكون GPG مثبتًا على النظام حتى تعمل هذه الوظيفة بشكل صحيح.
- يجب التأكد من أن المفاتيح الموثوقة (`trusted_keys`) يتم تمريرها بشكل صحيح عبر معامل `args`.
- يتم استخدام وظيفة `indent` لتحسين عرض ناتج GPG في حالة حدوث أخطاء.

**Output Example**: 
مثال على القيمة المرجعة:
```python
(
    ReturnCode.SUCCESS,  # رمز النجاح
    [SigData('ABC123', 'John Doe', trusted=True, status='')],  # توقيعات موثوقة
    [SigData('XYZ456', 'Jane Doe', trusted=False, status='')],  # توقيعات غير موثوقة
    [SigData('DEF789', 'Unknown', trusted=False, status='')],  # توقيعات غير معروفة
    [SigData('GHI012', 'Bad', trusted=False, status='')]       # توقيعات سيئة
)
```
## FunctionDef parse_sums_file(sums_file_path, filename_filter)
**parse_sums_file**: وظيفة `parse_sums_file` هي استخراج قيم التجزئة (hashes) وأسماء الملفات من ملف يحتوي على تجزئات SHA256.  

**parameters**: معاملات هذه الوظيفة.  
· `sums_file_path`: مسار الملف الذي يحتوي على تجزئات SHA256 وأسماء الملفات.  
· `filename_filter`: قائمة بأسماء الملفات التي يجب تصفية النتائج بناءً عليها. إذا كانت القائمة فارغة، يتم استخراج جميع السجلات.  

**Code Description**:  
تقوم هذه الوظيفة بقراءة ملف يحتوي على تجزئات SHA256 وأسماء الملفات المرتبطة بها. كل سطر في الملف يكون بتنسيق `<hash> <binary_filename>`، حيث `<hash>` هو تجزئة SHA256 و`<binary_filename>` هو اسم الملف الثنائي.  

الوظيفة تقوم بما يلي:  
1. تفتح الملف المحدد بواسطة `sums_file_path` للقراءة.  
2. تقرأ كل سطر من الملف.  
3. إذا كانت قائمة `filename_filter` فارغة، يتم استخراج جميع السجلات. وإلا، يتم استخراج السجلات التي تحتوي على أي من الأسماء المحددة في `filename_filter`.  
4. تقوم بتقسيم كل سطر إلى جزأين: التجزئة واسم الملف، وتعيد قائمة تحتوي على هذه الأزواج.  

في المشروع، يتم استدعاء هذه الوظيفة من قبل وظيفتين رئيسيتين:  
- `verify_published_handler`: حيث يتم استخدامها لاستخراج التجزئات وأسماء الملفات من ملف `SUMS_FILENAME` بناءً على نظام التشغيل المحدد (`os_filter`).  
- `verify_binaries_handler`: حيث يتم استخدامها لاستخراج التجزئات وأسماء الملفات من ملف `SUMS_FILENAME` بناءً على أسماء الملفات المحددة من قبل المستخدم.  

**Note**:  
- إذا كانت `filename_filter` فارغة، يتم استخراج جميع السجلات من الملف.  
- يجب أن يكون تنسيق الملف المدخل صحيحًا، حيث يجب أن يحتوي كل سطر على تجزئة SHA256 متبوعة باسم الملف.  

**Output Example**:  
مثال على القيمة المُرجعة:  
```python
[
    ["a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0", "bitcoin-22.0-x86_64-linux-gnu.tar.gz"],
    ["z9y8x7w6v5u4t3s2r1q0p1o2n3m4l5k6j7i8h9g0", "bitcoin-22.0-osx64.tar.gz"]
]
```
## FunctionDef verify_binary_hashes(hashes_to_verify)
**verify_binary_hashes**: وظيفة `verify_binary_hashes` هي التحقق من تطابق قيم التجزئة (hashes) للملفات الثنائية مع القيم المتوقعة.

**parameters**: معاملات هذه الوظيفة.
· `hashes_to_verify`: قائمة من القوائم تحتوي على أزواج من قيم التجزئة المتوقعة وأسماء الملفات الثنائية التي يجب التحقق منها. كل عنصر في القائمة هو قائمة من عنصرين: قيمة التجزئة المتوقعة واسم الملف الثنائي.

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من تطابق قيم التجزئة للملفات الثنائية مع القيم المتوقعة. يتم ذلك عن طريق قراءة كل ملف ثنائي وحساب قيمة التجزئة الخاصة به باستخدام خوارزمية SHA-256، ثم مقارنة هذه القيمة مع القيمة المتوقعة. إذا كانت القيم غير متطابقة، يتم إضافة اسم الملف إلى قائمة الملفات التي فشل التحقق منها (`offending_files`). إذا كانت القيم متطابقة، يتم تخزين اسم الملف وقيمة التجزئة المحسوبة في قاموس `files_to_hashes`.

في حالة وجود ملفات فشل التحقق منها، يتم تسجيل رسالة خطأ تشير إلى أن قيم التجزئة غير متطابقة مع قائمة الملفات الفاشلة. يتم إرجاع كود `ReturnCode.INTEGRITY_FAILURE` مع قاموس `files_to_hashes` الذي يحتوي على أسماء الملفات وقيم التجزئة المحسوبة. إذا كانت جميع الملفات متطابقة، يتم إرجاع كود `ReturnCode.SUCCESS` مع نفس القاموس.

يتم استخدام هذه الوظيفة في وظيفتين رئيسيتين في المشروع:
1. `verify_published_handler`: حيث يتم استدعاء `verify_binary_hashes` للتحقق من قيم التجزئة للملفات الثنائية التي تم تنزيلها من المضيفين.
2. `verify_binaries_handler`: حيث يتم استدعاء `verify_binary_hashes` للتحقق من قيم التجزئة للملفات الثنائية المحددة من قبل المستخدم.

**Note**: 
- يجب التأكد من أن الملفات الثنائية متاحة للقراءة قبل استدعاء هذه الوظيفة.
- في حالة فشل التحقق من أي ملف، يتم تسجيل رسالة خطأ تشير إلى الملفات الفاشلة، مما يساعد في تحديد المشكلة بسرعة.
- يتم استخدام كود `ReturnCode` للإشارة إلى نجاح أو فشل العملية، مما يسهل التعامل مع النتائج في الوظائف الأخرى.

**Output Example**: 
مثال على القيمة المرجعة:
```python
(ReturnCode.SUCCESS, {'file1': 'a1b2c3d4...', 'file2': 'e5f6g7h8...'})
```
أو في حالة الفشل:
```python
(ReturnCode.INTEGRITY_FAILURE, {'file1': 'a1b2c3d4...', 'file3': 'i9j0k1l2...'})
```
## FunctionDef verify_published_handler(args)
**verify_published_handler**: وظيفة `verify_published_handler` هي التحقق من صحة الإصدار المنشور من Bitcoin عن طريق تنزيل الملفات الثنائية وملفات التوقيعات من مضيفات محددة، والتحقق من سلامتها وتكاملها.

**parameters**: معاملات هذه الوظيفة.
· `args`: كائن من نوع `argparse.Namespace` يحتوي على الخيارات والوسائط التي تم تمريرها من سطر الأوامر. يتضمن هذا الكائن معلومات مثل الإصدار (`version`)، وخيارات التنظيف (`cleanup`)، وما إذا كان يجب تنزيل الملفات من جميع المضيفين (`require_all_hosts`).

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من صحة الإصدار المنشور من Bitcoin عن طريق تنفيذ الخطوات التالية:

1. **إنشاء دليل عمل مؤقت**: يتم إنشاء دليل عمل مؤقت في مجلد `/tmp` باستخدام اسم يعتمد على الإصدار المحدد (`args.version`). يتم استخدام هذا الدليل لتخزين الملفات المؤقتة التي يتم تنزيلها أثناء عملية التحقق.

2. **تحليل سلسلة الإصدار**: يتم تحليل سلسلة الإصدار (`args.version`) إلى مكوناتها الأساسية باستخدام وظيفة `parse_version_string`. يتم استخراج الإصدار الأساسي (`version_base`)، وإصدار المرشح (`version_rc`)، ونظام التشغيل (`os_filter`). إذا فشل التحليل، يتم إرجاع رمز خطأ `ReturnCode.BAD_VERSION`.

3. **تحديد المسار البعيد**: يتم تحديد المسار البعيد (`remote_dir`) على المضيفات بناءً على الإصدار المحدد. يتم استخدام هذا المسار لتنزيل ملفات التوقيعات (`SIGNATUREFILENAME`) وملفات المجاميع (`SUMS_FILENAME`).

4. **تنزيل ملفات التوقيعات والمجاميع**: يتم تنزيل ملفات التوقيعات والمجاميع من المضيفات المحددة (`HOST1` و`HOST2`) باستخدام وظيفة `get_files_from_hosts_and_compare`. يتم التحقق من أن الملفات متطابقة عبر المضيفين. إذا فشل التنزيل أو كانت الملفات غير متطابقة، يتم إرجاع رمز خطأ مناسب.

5. **التحقق من التوقيعات**: يتم التحقق من صحة توقيعات ملف المجاميع (`SUMS_FILENAME`) باستخدام وظيفة `verify_shasums_signature`. يتم تقييم التوقيعات بناءً على المفاتيح الموثوقة والمعايير المحددة. إذا لم يتم تحقيق الحد الأدنى من التوقيعات الجيدة، يتم إرجاع رمز خطأ `ReturnCode.NOT_ENOUGH_GOOD_SIGS`.

6. **استخراج التجزئات وأسماء الملفات**: يتم استخراج التجزئات وأسماء الملفات من ملف المجاميع (`SUMS_FILENAME`) باستخدام وظيفة `parse_sums_file`. يتم تصفية النتائج بناءً على نظام التشغيل المحدد (`os_filter`).

7. **تنزيل الملفات الثنائية**: يتم تنزيل الملفات الثنائية من المضيف الأول (`HOST1`) باستخدام وظيفة `download_with_wget`. يتم التحقق من نجاح التنزيل، وفي حالة الفشل، يتم إرجاع رمز خطأ `ReturnCode.BINARY_DOWNLOAD_FAILED`.

8. **التحقق من التجزئات**: يتم التحقق من تطابق قيم التجزئة للملفات الثنائية مع القيم المتوقعة باستخدام وظيفة `verify_binary_hashes`. إذا كانت القيم غير متطابقة، يتم إرجاع رمز خطأ `ReturnCode.INTEGRITY_FAILURE`.

9. **التنظيف**: إذا تم تعيين خيار `cleanup`، يتم حذف الملفات المؤقتة التي تم تنزيلها. وإلا، يتم تسجيل رسالة تشير إلى أن الملفات لم يتم تنظيفها.

10. **إخراج النتائج**: إذا تم تعيين خيار `json`، يتم إخراج النتائج بتنسيق JSON يحتوي على التوقيعات الجيدة والموثوقة، والملفات التي تم التحقق منها. وإلا، يتم طباعة أسماء الملفات التي تم التحقق منها.

**Note**: 
- يجب أن تكون سلسلة الإصدار بتنسيق محدد، مثل `<version>-rcN-platform` أو `<version>-platform` أو `<version>-rcN`.
- يجب أن تكون أداة `wget` مثبتة على النظام لتنزيل الملفات.
- يجب أن تكون المفاتيح الموثوقة (`trusted_keys`) متاحة للتحقق من التوقيعات.

**Output Example**: 
مثال على القيمة المرجعة:
```python
ReturnCode.SUCCESS
```
أو في حالة الفشل:
```python
ReturnCode.BAD_VERSION
```
### FunctionDef cleanup
**cleanup**: وظيفة cleanup هي تنظيف الملفات المؤقتة وحذفها من الدليل المحدد.

**parameters**: لا تحتوي هذه الدالة على أي معاملات (parameters).

**Code Description**: تقوم هذه الدالة بتنفيذ عدة خطوات لتنظيف الملفات المؤقتة:
1. تقوم بطباعة رسالة في السجل (log) تفيد ببدء عملية التنظيف باستخدام الأمر `log.info("cleaning up files")`.
2. تغير الدالة الدليل الحالي إلى الدليل الرئيسي للمستخدم باستخدام الأمر `os.chdir(Path.home())`. هذا يضمن أن العملية تتم في مكان آمن ولا تؤثر على أي أدلة أخرى.
3. تقوم بحذف الدليل المحدد (المخزن في المتغير `WORKINGDIR`) بشكل كامل باستخدام الأمر `shutil.rmtree(WORKINGDIR)`. هذا الأمر يحذف الدليل وجميع الملفات والمجلدات الفرعية بداخله.

**Note**: 
- يجب التأكد من أن المتغير `WORKINGDIR` يحتوي على المسار الصحيح للدليل الذي تريد حذفه، حيث أن هذه العملية لا يمكن التراجع عنها.
- يُفضل استخدام هذه الدالة بحذر، خاصة إذا كانت تعمل مع ملفات أو أدلة مهمة، حيث أن عملية الحذف نهائية.
***
## FunctionDef verify_binaries_handler(args)
**verify_binaries_handler**: وظيفة `verify_binaries_handler` هي التحقق من صحة الملفات الثنائية المحلية عن طريق التحقق من توقيعات ملف المجاميع (SHA256SUMS) ومطابقة قيم التجزئة (hashes) للملفات الثنائية المحددة.

**parameters**: معاملات هذه الوظيفة.
· `args`: كائن من نوع `argparse.Namespace` يحتوي على الخيارات التالية:
  - `binary`: قائمة بمسارات الملفات الثنائية التي يجب التحقق منها.
  - `sums_sig_file`: مسار ملف التوقيعات الخاص بملف المجاميع (SHA256SUMS.asc). إذا لم يتم تحديده، يتم افتراض أن اسم الملف هو نفس اسم ملف المجاميع مع إضافة اللاحقة `.asc`.
  - `sums_file`: مسار ملف المجاميع (SHA256SUMS) الذي يحتوي على قيم التجزئة وأسماء الملفات.
  - `json`: إذا تم تعيينه، يتم إخراج النتائج بتنسيق JSON.

**Code Description**: 
تقوم هذه الوظيفة بالتحقق من صحة الملفات الثنائية المحلية عن طريق الخطوات التالية:

1. **إنشاء قاموس للملفات الثنائية**: يتم إنشاء قاموس `binary_to_basename` الذي يربط بين أسماء الملفات الثنائية ومساراتها الكاملة. يتم ذلك عن طريق استخراج اسم الملف الأساسي (basename) من المسار الكامل لكل ملف ثنائي.

2. **تحديد مسار ملف التوقيعات**: إذا لم يتم تحديد مسار ملف التوقيعات (`sums_sig_file`)، يتم افتراض أن اسم الملف هو نفس اسم ملف المجاميع مع إضافة اللاحقة `.asc`.

3. **التحقق من توقيع ملف المجاميع**: يتم استدعاء وظيفة `verify_shasums_signature` للتحقق من صحة توقيع ملف المجاميع. إذا فشل التحقق، يتم إرجاع رمز الخطأ المناسب.

4. **استخراج قيم التجزئة وأسماء الملفات**: يتم استدعاء وظيفة `parse_sums_file` لاستخراج قيم التجزئة وأسماء الملفات من ملف المجاميع. إذا لم يتم العثور على أي ملفات تطابق الملفات الثنائية المحددة، يتم إرجاع رمز الخطأ `ReturnCode.NO_BINARIES_MATCH`.

5. **التحقق من وجود جميع الملفات**: يتم التحقق من أن جميع الملفات الثنائية المحددة موجودة في ملف المجاميع. إذا كانت بعض الملفات مفقودة، يتم تسجيلها في قائمة `missing_files`.

6. **التحقق من قيم التجزئة**: يتم استدعاء وظيفة `verify_binary_hashes` للتحقق من تطابق قيم التجزئة للملفات الثنائية مع القيم المتوقعة. إذا فشل التحقق، يتم إرجاع رمز الخطأ المناسب.

7. **إخراج النتائج**: إذا تم تعيين الخيار `json`، يتم إخراج النتائج بتنسيق JSON يحتوي على التوقيعات الجيدة، التوقيعات غير الموثوقة، التوقيعات غير المعروفة، التوقيعات السيئة، الملفات التي تم التحقق منها، والملفات المفقودة. إذا لم يتم تعيين الخيار `json`، يتم طباعة أسماء الملفات التي تم التحقق منها والملفات المفقودة.

**Note**: 
- يجب أن تكون المفاتيح الموثوقة (`trusted_keys`) متاحة إذا كانت هناك حاجة للتحقق من التوقيعات الموثوقة.
- يجب أن تكون الملفات الثنائية متاحة للقراءة قبل استدعاء هذه الوظيفة.
- يتم استخدام كود `ReturnCode` للإشارة إلى نجاح أو فشل العملية، مما يسهل التعامل مع النتائج في الوظائف الأخرى.

**Output Example**: 
مثال على القيمة المرجعة:
```python
ReturnCode.SUCCESS
```
أو في حالة الفشل:
```python
ReturnCode.NO_BINARIES_MATCH
```
مثال على الإخراج بتنسيق JSON:
```json
{
    "good_trusted_sigs": ["ABC123"],
    "good_untrusted_sigs": ["XYZ456"],
    "unknown_sigs": ["DEF789"],
    "bad_sigs": ["GHI012"],
    "verified_binaries": {"file1": "a1b2c3d4..."},
    "missing_binaries": ["file2"]
}
```
## FunctionDef main
**main**: وظيفة `main` هي نقطة الدخول الرئيسية للبرنامج، حيث تقوم بمعالجة وسائط سطر الأوامر وتوجيه التنفيذ إلى الوظيفة المناسبة بناءً على الأمر المحدد.

**parameters**: لا تحتوي هذه الوظيفة على معاملات مباشرة، ولكنها تعتمد على وسائط سطر الأوامر التي يتم تمريرها عند تشغيل البرنامج.

**Code Description**: 
تقوم وظيفة `main` بتنفيذ الخطوات التالية:

1. **إنشاء محلل وسائط سطر الأوامر**: يتم إنشاء كائن `ArgumentParser` من مكتبة `argparse` لمعالجة وسائط سطر الأوامر. يتم تعيين وصف البرنامج باستخدام `__doc__`.

2. **إضافة وسائط عامة**: يتم إضافة عدة وسائط عامة يمكن استخدامها مع جميع الأوامر الفرعية:
   - `-v` أو `--verbose`: لتفعيل وضع التفصيل (verbose mode) الذي يعرض معلومات إضافية أثناء التنفيذ. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_VERBOSE` باستخدام وظيفة `bool_from_env`.
   - `-q` أو `--quiet`: لتقليل مستوى التفاصيل المعروضة. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_QUIET`.
   - `--import-keys`: لطلب استيراد المفاتيح غير المعروفة تلقائيًا. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_IMPORTKEYS`.
   - `--min-good-sigs`: لتحديد الحد الأدنى لعدد التوقيعات الجيدة المطلوبة للتحقق الناجح. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_MIN_GOOD_SIGS`.
   - `--keyserver`: لتحديد خادم المفاتيح المستخدم. القيمة الافتراضية هي `hkps://keys.openpgp.org`، ويمكن تغييرها من خلال متغيرة البيئة `BINVERIFY_KEYSERVER`.
   - `--trusted-keys`: لتحديد قائمة بالمفاتيح الموثوقة. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_TRUSTED_KEYS`.
   - `--json`: لإخراج النتائج بتنسيق JSON. القيمة الافتراضية يتم تحديدها من خلال متغيرة البيئة `BINVERIFY_JSON`.

3. **إضافة أوامر فرعية**: يتم إنشاء أوامر فرعية باستخدام `add_subparsers`، حيث يتم تحديد أمرين رئيسيين:
   - `pub`: للتحقق من إصدار منشور من Bitcoin. يتم تعيين الوظيفة `verify_published_handler` كمعالج لهذا الأمر. يتم إضافة وسائط إضافية مثل `version` للإصدار المطلوب، و`--cleanup` لتنظيف الملفات المؤقتة بعد الانتهاء، و`--require-all-hosts` للتحقق من جميع المضيفين.
   - `bin`: للتحقق من الملفات الثنائية المحلية. يتم تعيين الوظيفة `verify_binaries_handler` كمعالج لهذا الأمر. يتم إضافة وسائط إضافية مثل `--sums-sig-file` لملف التوقيعات، و`sums_file` لملف المجاميع، و`binary` للملفات الثنائية المطلوب التحقق منها.

4. **معالجة الوسائط**: يتم تحليل وسائط سطر الأوامر باستخدام `parser.parse_args()`. إذا تم تعيين الوسيطة `--quiet`، يتم تقليل مستوى تسجيل الأحداث (logging level) إلى `WARNING`.

5. **تنفيذ الوظيفة المناسبة**: يتم استدعاء الوظيفة المحددة بناءً على الأمر الفرعي الذي تم تمريره (`args.func`) مع تمرير الوسائط المحللة (`args`).

**Note**: 
- يجب أن تكون متغيرات البيئة المحددة (`BINVERIFY_*`) موجودة وقيمها صحيحة لتحديد القيم الافتراضية بشكل صحيح.
- يمكن استخدام الخيار `--json` لإخراج النتائج بتنسيق JSON، مما يسهل معالجة النتائج برمجيًا.

**Output Example**: 
مثال على القيمة المرجعة:
```python
ReturnCode.SUCCESS
```
أو في حالة الفشل:
```python
ReturnCode.BAD_VERSION
```
