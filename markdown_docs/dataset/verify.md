## ClassDef ReturnCode
**ReturnCode**: وظيفة ReturnCode هي تحديد رموز الحالة المختلفة التي يمكن أن ترجعها العمليات المختلفة في البرنامج.

**attributes**: خصائص هذه الفئة.
· SUCCESS: رمز الحالة الذي يشير إلى نجاح العملية (0).
· INTEGRITY_FAILURE: رمز الحالة الذي يشير إلى فشل في التحقق من النزاهة (1).
· FILE_GET_FAILED: رمز الحالة الذي يشير إلى فشل في الحصول على الملف (4).
· FILE_MISSING_FROM_ONE_HOST: رمز الحالة الذي يشير إلى عدم وجود ملف من أحد المضيفين (5).
· FILES_NOT_EQUAL: رمز الحالة الذي يشير إلى أن الملفات ليست متساوية (6).
· NO_BINARIES_MATCH: رمز الحالة الذي يشير إلى عدم تطابق أي ثنائيات (7).
· NOT_ENOUGH_GOOD_SIGS: رمز الحالة الذي يشير إلى عدم وجود عدد كافٍ من التوقيعات الجيدة (9).
· BINARY_DOWNLOAD_FAILED: رمز الحالة الذي يشير إلى فشل في تنزيل الثنائيات (10).
· BAD_VERSION: رمز الحالة الذي يشير إلى إصدار غير صحيح (11).

**Code Description**: ReturnCode هي فئة تستخدم لتحديد مجموعة من رموز الحالة التي تعكس نتائج العمليات المختلفة في البرنامج. يتم استخدام هذه الرموز لتسهيل فهم حالة العملية التي تم تنفيذها، سواء كانت ناجحة أو فشلت لأسباب معينة. 

تستخدم هذه الفئة في عدة وظائف في البرنامج مثل `get_files_from_hosts_and_compare` و `verify_shasums_signature` و `verify_binary_hashes` و `verify_published_handler` و `verify_binaries_handler`. كل من هذه الوظائف تعتمد على ReturnCode لتحديد النتيجة النهائية للعملية. على سبيل المثال، إذا فشلت عملية تنزيل ملف، فإن الوظيفة ستعيد ReturnCode.FILE_GET_FAILED. إذا كانت جميع الملفات متساوية، فستعيد ReturnCode.SUCCESS. 

تساعد ReturnCode المطورين في تتبع الأخطاء وفهم النتائج بشكل أفضل، مما يسهل عملية التصحيح وتحسين الأداء العام للبرنامج.

**Note**: من المهم ملاحظة أن استخدام ReturnCode يجب أن يكون متسقًا عبر جميع الوظائف لضمان فهم واضح لحالة كل عملية.
## FunctionDef set_up_logger(is_verbose)
**set_up_logger**: The function of set_up_logger is إعداد مسجل يسجل الرسائل إلى stderr.

**parameters**: The parameters of this Function.
· is_verbose: bool = True - يحدد ما إذا كان يجب تسجيل الرسائل بمستوى معلوماتي (INFO) أو تحذيري (WARNING).

**Code Description**: 
تقوم دالة set_up_logger بإعداد مسجل (logger) يستخدم لتسجيل الرسائل. يتم استخدام مكتبة logging في بايثون لإنشاء هذا المسجل. عند استدعاء الدالة، يتم تحديد مستوى التسجيل بناءً على قيمة المعامل is_verbose. إذا كانت القيمة True، يتم تعيين مستوى التسجيل إلى INFO، مما يعني أنه سيتم تسجيل الرسائل بمستوى المعلومات وما فوق. إذا كانت القيمة False، يتم تعيين مستوى التسجيل إلى WARNING، مما يعني أنه سيتم تسجيل الرسائل التحذيرية وما فوق فقط.

تقوم الدالة أيضًا بإنشاء معالج تدفق (StreamHandler) يقوم بتوجيه الرسائل إلى stderr (الإخراج القياسي للأخطاء). يتم تعيين مستوى هذا المعالج إلى DEBUG، مما يعني أنه يمكنه تسجيل جميع الرسائل بمستوى DEBUG وما فوق. بعد ذلك، يتم إعداد تنسيق الرسائل باستخدام Formatter، حيث يتم عرض مستوى الرسالة ونص الرسالة. وأخيرًا، يتم إضافة المعالج إلى المسجل وإرجاع المسجل المعد.

**Note**: يجب الانتباه إلى أن استخدام is_verbose كقيمة افتراضية True يعني أن الرسائل بمستوى المعلومات ستكون مسجلة بشكل افتراضي، مما قد يكون مفيدًا أثناء التطوير ولكن قد يتطلب تعديلات في بيئات الإنتاج.

**Output Example**: 
عند استدعاء الدالة set_up_logger() مع القيمة الافتراضية، قد يظهر الإخراج كالتالي عند تسجيل رسالة:
```
[INFO] هذه رسالة معلوماتية
```
## FunctionDef indent(output)
**indent**: The function of indent is إضافة مسافة بادئة إلى نص معين.

**parameters**: The parameters of this Function.
· output: نص الإدخال الذي سيتم إضافة المسافة البادئة إليه.

**Code Description**: تقوم دالة indent بإضافة مسافة بادئة إلى النص المقدم كمدخل. تستخدم هذه الدالة مكتبة textwrap في بايثون، والتي توفر أدوات لتنسيق النصوص. عند استدعاء هذه الدالة، يتم تمرير نص معين، وتقوم الدالة بإرجاع النص نفسه مع إضافة مسافة بادئة من مسافتين في بداية كل سطر. 

تظهر أهمية هذه الدالة في سياق استخدامها في دوال أخرى مثل files_are_equal وget_files_from_hosts_and_compare وcheck_multisig وverify_shasums_signature. في هذه الدوال، يتم استخدام indent لتنسيق المخرجات النصية، مثل رسائل الخطأ أو التحذيرات، مما يسهل قراءتها وفهمها. على سبيل المثال، في دالة files_are_equal، يتم استخدام indent لتنسيق الاختلافات بين الملفات عند عدم تطابق محتوياتها، مما يساعد المطورين على تحديد المشكلات بسرعة أكبر.

**Note**: يجب التأكد من أن النص المدخل إلى الدالة ليس فارغًا، حيث أن النص الفارغ سيؤدي إلى إرجاع نص فارغ مع مسافة بادئة، مما قد يكون غير مفيد في بعض الحالات.

**Output Example**: إذا كانت قيمة output هي "Hello\nWorld"، فإن نتيجة الدالة ستكون:
```
  Hello
  World
```
## FunctionDef bool_from_env(key, default)
**bool_from_env**: The function of bool_from_env is استرجاع قيمة من متغير بيئة على شكل قيمة منطقية.

**parameters**: The parameters of this Function.
· parameter1: key - المفتاح الذي يمثل اسم متغير البيئة المطلوب استرجاع قيمته.
· parameter2: default - القيمة الافتراضية التي سيتم إرجاعها إذا لم يكن هناك متغير بيئة بالاسم المحدد (افتراضيًا False).

**Code Description**: 
تقوم دالة bool_from_env بالتحقق مما إذا كان هناك متغير بيئة بالاسم المحدد في المعامل الأول (key). إذا لم يكن المتغير موجودًا، فإنها تعيد القيمة الافتراضية المحددة في المعامل الثاني (default). إذا كان المتغير موجودًا، تقوم الدالة بقراءة قيمته وتحويلها إلى قيمة منطقية. إذا كانت القيمة تساوي '1' أو 'true' (بغض النظر عن حالة الأحرف)، فإن الدالة تعيد True. إذا كانت القيمة تساوي '0' أو 'false'، فإنها تعيد False. في حالة وجود قيمة غير معروفة، يتم رفع استثناء ValueError مع رسالة توضح القيمة غير المعروفة.

تستخدم هذه الدالة في مشروع verify.py، حيث يتم استدعاؤها لتحديد القيم الافتراضية للخيارات المختلفة عند تنفيذ البرنامج. على سبيل المثال، يتم استخدامها لتحديد ما إذا كان يجب تشغيل البرنامج في وضع verbose أو quiet، أو ما إذا كان يجب استيراد مفاتيح جديدة. هذا يسمح للمستخدمين بتخصيص سلوك البرنامج بناءً على إعدادات البيئة الخاصة بهم.

**Note**: يجب التأكد من أن القيم المستخدمة في متغيرات البيئة تتوافق مع القيم المتوقعة ('1', 'true', '0', 'false') لتجنب رفع استثناءات غير مرغوب فيها.

**Output Example**: 
إذا كان متغير البيئة 'BINVERIFY_VERBOSE' موجودًا ويحتوي على القيمة 'true'، فإن الدالة ستعيد True. إذا لم يكن متغير البيئة موجودًا، فستعيد القيمة الافتراضية المحددة، والتي هي False.
## FunctionDef parse_version_string(version_str)
**parse_version_string**: The function of parse_version_string is تحليل سلسلة الإصدار.

**parameters**: 
· version_str: سلسلة نصية تمثل إصدار البرنامج، والتي قد تحتوي على معلومات إضافية مثل "rc" أو نظام التشغيل.

**Code Description**: 
تقوم دالة parse_version_string بتحليل سلسلة الإصدار المقدمة كمعامل. تبدأ الدالة بتقسيم السلسلة إلى أجزاء باستخدام الفاصل "-"، حيث يتم تخزين الجزء الأول في متغير version_base. إذا كانت السلسلة تحتوي على جزءين، يتم التحقق مما إذا كان الجزء الثاني يحتوي على "rc" لتحديد ما إذا كان الإصدار هو إصدار مرشح (release candidate) أو نظام تشغيل. في حالة وجود ثلاثة أجزاء، يتم تعيين الجزء الثاني كإصدار مرشح والجزء الثالث كنظام تشغيل. في النهاية، تقوم الدالة بإرجاع ثلاثة قيم: version_base، version_rc، وversion_os.

تستخدم هذه الدالة في سياق دالة verify_published_handler، حيث يتم استدعاؤها لتحليل سلسلة الإصدار التي يتم تمريرها كجزء من معلمات الدالة. إذا كانت السلسلة غير صحيحة أو لا تتبع التنسيق المتوقع، يتم تسجيل خطأ وإرجاع رمز خطأ. هذا يضمن أن الدالة verify_published_handler تعمل مع معلومات إصدار صحيحة قبل المتابعة إلى خطوات التحقق من الملفات.

**Note**: يجب التأكد من أن سلسلة الإصدار تتبع التنسيق الصحيح، وإلا ستؤدي إلى أخطاء في معالجة البيانات.

**Output Example**: 
إذا كانت سلسلة الإصدار المدخلة هي "1.0.0-rc1-linux"، فإن القيم المرجعة ستكون:
- version_base: "1.0.0"
- version_rc: "rc1"
- version_os: "linux"
## FunctionDef download_with_wget(remote_file, local_file)
**download_with_wget**: The function of download_with_wget is تحميل ملف من الإنترنت باستخدام أداة wget.

**parameters**: The parameters of this Function.
· parameter1: remote_file - عنوان URL للملف الذي سيتم تحميله.
· parameter2: local_file - اسم الملف المحلي الذي سيتم حفظ الملف المحمل فيه.

**Code Description**: تقوم الدالة download_with_wget بتنفيذ عملية تحميل ملف من مصدر بعيد باستخدام أداة wget. يتم تمرير عنوان URL للملف المراد تحميله واسم الملف المحلي الذي سيتم حفظه فيه كمعاملات. تستخدم الدالة subprocess.run لتشغيل أمر wget، حيث يتم توجيه الإخراج القياسي (stdout) والأخطاء (stderr) إلى المتغيرات المناسبة. تعيد الدالة قيمة منطقية تشير إلى نجاح العملية (True إذا تم التحميل بنجاح، وFalse إذا فشلت) بالإضافة إلى الإخراج الناتج عن أمر wget.

تُستخدم هذه الدالة في سياق أكبر من خلال استدعائها في دوال أخرى مثل get_files_from_hosts_and_compare و verify_published_handler. في get_files_from_hosts_and_compare، يتم استخدام download_with_wget لتحميل الملفات من مجموعة من المضيفين والتحقق من تطابق المحتويات. بينما في verify_published_handler، يتم استخدامها لتحميل ملفات التوقيع وملفات المجموعات (SUMS) من مضيفين محددين، مما يساهم في عملية التحقق من سلامة الملفات المحملة.

**Note**: من المهم التأكد من أن أداة wget مثبتة على النظام قبل استخدام هذه الدالة، حيث تعتمد على وجودها لتنفيذ عملية التحميل.

**Output Example**: 
يمكن أن تكون نتيجة الدالة كما يلي:
```python
(success, output) = download_with_wget("http://example.com/file.txt", "local_file.txt")
# حيث success سيكون True إذا تم التحميل بنجاح، وoutput يحتوي على نص الإخراج من wget.
```
## FunctionDef download_lines_with_urllib(url)
**download_lines_with_urllib**: وظيفة download_lines_with_urllib هي الحصول على (نجاح، خطوط نصية من ملف) عبر HTTP.

**parameters**: معلمات هذه الوظيفة.
· url: عنوان URL للملف الذي سيتم تحميله.

**Code Description**: تقوم وظيفة download_lines_with_urllib بمحاولة تحميل محتوى نصي من ملف موجود على الإنترنت باستخدام بروتوكول HTTP. تأخذ الوظيفة عنوان URL كمعامل، وتقوم بإجراء طلب HTTP للحصول على محتوى الملف. إذا كان الطلب ناجحًا، تقوم الوظيفة بقراءة كل سطر من المحتوى، وتقوم بإزالة المسافات البيضاء من البداية والنهاية، ثم تعيد قائمة تحتوي على هذه الأسطر. إذا حدث خطأ أثناء الطلب، مثل HTTPError، يتم تسجيل تحذير مع تفاصيل الخطأ، وتعيد الوظيفة قيمة (False، قائمة فارغة) للإشارة إلى الفشل في تحميل البيانات.

**Note**: من المهم التأكد من أن عنوان URL صالح وأن الملف المطلوب متاح على الخادم. يجب أن تكون مكتبة urllib مستوردة في بداية البرنامج لاستخدام هذه الوظيفة بشكل صحيح.

**Output Example**: قد تكون نتيجة الوظيفة كما يلي:
(True, ['السطر الأول من النص', 'السطر الثاني من النص', 'السطر الثالث من النص'])
## FunctionDef verify_with_gpg(filename, signature_filename, output_filename)
**verify_with_gpg**: The function of verify_with_gpg is التحقق من صحة ملف باستخدام GPG.

**parameters**: The parameters of this Function.
· filename: اسم الملف الذي سيتم التحقق من صحته.  
· signature_filename: اسم ملف التوقيع الذي سيتم استخدامه للتحقق.  
· output_filename: اسم الملف الذي سيتم تخزين الناتج فيه (اختياري).  

**Code Description**: تقوم الدالة verify_with_gpg بالتحقق من صحة ملف معين باستخدام أداة GPG. يتم تمرير اسم الملف واسم ملف التوقيع كمعاملات أساسية. إذا تم توفير اسم ملف للإخراج، فسيتم استخدامه لتخزين الناتج، وإلا سيتم تركه فارغًا. 

تقوم الدالة بإنشاء ملف مؤقت لتخزين حالة التحقق، ثم تقوم ببناء قائمة من الأوامر التي سيتم تمريرها إلى GPG. يتم ضبط البيئة لتكون اللغة الإنجليزية. بعد ذلك، يتم تنفيذ الأمر باستخدام subprocess.run، حيث يتم التقاط كل من الإخراج والأخطاء. 

بعد تنفيذ الأمر، يتم قراءة البيانات من ملف الحالة المؤقت وفك تشفيرها. يتم تسجيل نتائج GPG باستخدام log.debug، حيث يتم تضمين كود الإرجاع والناتج. في النهاية، تعيد الدالة كود الإرجاع وبيانات GPG.

تُستخدم هذه الدالة في سياق الدالة check_multisig، التي تتحقق من صحة التوقيع لملف معين. تقوم check_multisig باستدعاء verify_with_gpg للتحقق من صحة ملف التوقيع، ثم تقوم بتحليل الناتج. إذا كانت هناك توقيعات غير موثوقة، يمكن أن تطلب من المستخدم استرداد المفاتيح المفقودة قبل إعادة التحقق. 

**Note**: يجب التأكد من أن GPG مثبتة ومهيأة بشكل صحيح على النظام قبل استخدام هذه الدالة. كما يجب أن تكون الملفات المقدمة موجودة وقابلة للوصول.

**Output Example**: قد يكون الناتج من الدالة على الشكل التالي:
```
(0, "gpg: Signature made ...\ngpg: Good signature from ...")
```
## FunctionDef remove_files(filenames)
**remove_files**: The function of remove_files is حذف الملفات المحددة من النظام.

**parameters**: The parameters of this Function.
· parameter1: filenames - قائمة تحتوي على أسماء الملفات التي سيتم حذفها.

**Code Description**: تقوم دالة remove_files بأخذ قائمة من أسماء الملفات كمدخلات، ثم تقوم بحذف كل ملف من هذه القائمة باستخدام دالة os.remove. يتم تنفيذ عملية الحذف من خلال حلقة for، حيث يتم تكرار كل اسم ملف في القائمة واستدعاء دالة os.remove لكل اسم. من المهم أن تكون الملفات الموجودة في القائمة موجودة بالفعل في النظام، وإلا ستظهر رسالة خطأ تفيد بعدم وجود الملف.

**Note**: نقاط يجب مراعاتها عند استخدام الكود:
- تأكد من أن الملفات التي ترغب في حذفها ليست قيد الاستخدام من قبل أي عملية أخرى.
- كن حذرًا عند استخدام هذه الدالة، حيث أن حذف الملفات لا يمكن التراجع عنه، مما يعني أنه سيتم فقدان البيانات بشكل دائم.
- من المستحسن إجراء فحص أو تأكيد قبل تنفيذ عملية الحذف لتجنب حذف الملفات الهامة عن طريق الخطأ.
## ClassDef SigData
**SigData**: وظيفة SigData هي تمثيل بيانات التوقيع GPG كما تم تحليلها من مخرجات GPG.

**attributes**: خصائص هذه الفئة.
· key: تمثل مفتاح التوقيع، ويمكن أن تكون None إذا لم يتم تعيينها.
· name: تمثل اسم التوقيع، وهو سلسلة نصية.
· trusted: تمثل حالة الثقة في التوقيع، وهي قيمة منطقية (True أو False).
· status: تمثل حالة التوقيع، وهي سلسلة نصية تصف حالة التوقيع (مثل "expired" أو "revoked").

**Code Description**: 
تعتبر فئة SigData هيكل بيانات يستخدم لتمثيل معلومات التوقيع الناتجة عن عملية التحقق من التوقيع باستخدام GPG. تحتوي الفئة على أربعة خصائص رئيسية: key، name، trusted، وstatus. يتم تعيين قيمة key إلى None بشكل افتراضي، مما يعني أنه لم يتم تعيين مفتاح بعد. يتم تعيين name كسلسلة نصية فارغة، وtrusted كقيمة False بشكل افتراضي، مما يشير إلى أن التوقيع غير موثوق به حتى يتم التأكيد على عكس ذلك. يمكن أن تحتوي status على معلومات إضافية حول حالة التوقيع، مثل ما إذا كان قد تم إلغاؤه أو انتهت صلاحيته.

تتضمن الفئة أيضًا دالة __bool__ التي تعيد True إذا كان هناك مفتاح معين (أي أن key ليس None)، مما يسمح باستخدام الكائن في سياقات تتطلب قيمة منطقية. كما تحتوي على دالة __repr__ التي توفر تمثيلًا نصيًا للكائن، مما يسهل فهم حالة التوقيع عند الطباعة.

تستخدم فئة SigData في عدة دوال في المشروع، مثل parse_gpg_result وcheck_multisig وverify_shasums_signature. في دالة parse_gpg_result، يتم تحليل مخرجات GPG إلى قائمة من كائنات SigData، حيث يتم تصنيف التوقيعات إلى جيدة وغير معروفة وسيئة. يتم استخدام هذه الكائنات لاحقًا في دالة check_multisig للتحقق من التوقيعات المتعددة، وفي دالة verify_shasums_signature لتأكيد صحة التوقيعات.

**Note**: من المهم ملاحظة أن الكائنات من فئة SigData تُستخدم لتخزين معلومات التوقيع، ويجب أن يتم التعامل معها بعناية لضمان دقة المعلومات المستخرجة من مخرجات GPG.

**Output Example**: 
يمكن أن يبدو مخرجات الكود كالتالي:
```
SigData(key='ABC123', name='Example Signature', trusted=True, status='valid')
```
### FunctionDef __init__(self)
**__init__**: The function of __init__ is to initialize an instance of the class with default attribute values.

**parameters**: The parameters of this Function.
· لا توجد معلمات.

**Code Description**: هذه الدالة هي مُنشئ (constructor) تستخدم لتهيئة كائن من الفئة. عند استدعاء هذه الدالة، يتم تعيين القيم الافتراضية للسمات التالية:
- `self.key`: يتم تعيينه إلى `None`، مما يعني أنه لا يوجد مفتاح محدد عند إنشاء الكائن.
- `self.name`: يتم تعيينه إلى سلسلة فارغة `""`، مما يشير إلى أن الاسم غير محدد بعد.
- `self.trusted`: يتم تعيينه إلى `False`، مما يعني أن الكائن غير موثوق به بشكل افتراضي.
- `self.status`: يتم تعيينه إلى سلسلة فارغة `""`، مما يعني أن الحالة غير محددة.

بشكل عام، هذه الدالة تضمن أن كل كائن يتم إنشاؤه من هذه الفئة يبدأ بحالة معروفة وقيم افتراضية، مما يسهل إدارة الكائنات في البرنامج.

**Note**: من المهم ملاحظة أن هذه الدالة لا تأخذ أي معلمات عند استدعائها، مما يجعلها بسيطة وسهلة الاستخدام. يجب على المطورين التأكد من تحديث السمات بعد إنشاء الكائن إذا كانت هناك حاجة لتعيين قيم معينة.
***
### FunctionDef __bool__(self)
**__bool__**: The function of __bool__ is تحديد ما إذا كانت الكائنات تحتوي على مفتاح صالح أم لا.

**parameters**: لا توجد معلمات لهذه الدالة.

**Code Description**: تقوم دالة __bool__ بإرجاع قيمة منطقية (Boolean) تحدد ما إذا كان الكائن يحتوي على مفتاح صالح. يتم ذلك من خلال التحقق مما إذا كانت الخاصية `key` غير فارغة (أي ليست None). إذا كانت `key` تحتوي على قيمة، فإن الدالة تعيد True، مما يعني أن الكائن يعتبر "صحيحًا" أو "موجودًا". أما إذا كانت `key` تساوي None، فإن الدالة تعيد False، مما يعني أن الكائن يعتبر "غير موجود" أو "غير صحيح". هذه الدالة مفيدة في حالات التحقق من وجود الكائنات أو استخدامها في الشروط.

**Note**: من المهم ملاحظة أن هذه الدالة تعتمد على وجود خاصية `key` في الكائن. إذا لم تكن الخاصية موجودة أو لم يتم تعيينها، فقد يؤدي ذلك إلى سلوك غير متوقع.

**Output Example**: 
- إذا كانت `key` تساوي "abc"، فإن الدالة ستعيد True.
- إذا كانت `key` تساوي None، فإن الدالة ستعيد False.
***
### FunctionDef __repr__(self)
**__repr__**: The function of __repr__ is إرجاع تمثيل نصي لكائن SigData.

**parameters**: لا توجد معلمات لهذا الدالة.

**Code Description**: تقوم دالة __repr__ بإرجاع تمثيل نصي لكائن من نوع SigData. يتم استخدام هذه الدالة عادةً لتوفير معلومات مفيدة عند طباعة الكائن أو عند استخدامه في بيئات تفاعلية. في هذا التمثيل النصي، يتم تضمين الخصائص الأساسية للكائن، وهي: المفتاح (key)، الاسم (name)، الثقة (trusted)، والحالة (status). يتم تنسيق هذه القيم في سلسلة نصية باستخدام صيغة معينة، مما يسهل على المطورين فهم حالة الكائن بسرعة.

**Note**: من المهم ملاحظة أن دالة __repr__ يجب أن تعكس بدقة الحالة الحالية للكائن، حيث يمكن أن تكون هذه المعلومات مفيدة في تصحيح الأخطاء أو أثناء تطوير البرمجيات.

**Output Example**: قد يكون مظهر القيمة المرجعة من هذه الدالة كما يلي: 
SigData('12345', 'ExampleName', trusted=True, status='active')
***
## FunctionDef parse_gpg_result(output)
**parse_gpg_result**: وظيفة parse_gpg_result هي تحليل مخرجات GPG لاسترجاع التوقيعات الجيدة وغير المعروفة والسيئة.

**parameters**: المعلمات لهذه الوظيفة.
· output: قائمة من السلاسل النصية تمثل مخرجات GPG.

**Code Description**: تقوم دالة parse_gpg_result بتحليل مخرجات GPG التي يتم تمريرها كقائمة من السلاسل النصية. الهدف من هذه الدالة هو تصنيف التوقيعات المستخرجة إلى ثلاث فئات: التوقيعات الجيدة (good signatures)، التوقيعات غير المعروفة (unknown signatures)، والتوقيعات السيئة (bad signatures). يتم استخدام كائنات من فئة SigData لتخزين معلومات كل توقيع.

تبدأ الدالة بتعريف ثلاث قوائم فارغة لتخزين التوقيعات الجيدة وغير المعروفة والسيئة. كما يتم تعريف دالة داخلية line_begins_with للتحقق مما إذا كانت السطور تبدأ بنمط معين، مما يساعد في منع إدخال بيانات ضارة.

تقوم الدالة بعد ذلك بقراءة كل سطر في مخرجات GPG. بناءً على الأنماط المحددة، يتم تصنيف كل توقيع إلى الفئة المناسبة. على سبيل المثال، إذا كان السطر يحتوي على "GOODSIG"، يتم إضافة التوقيع إلى قائمة التوقيعات الجيدة. إذا كان السطر يحتوي على "BADSIG"، يتم إضافته إلى قائمة التوقيعات السيئة.

بعد معالجة جميع السطور، يتم التحقق من أن العدد الإجمالي للتوقيعات المستخرجة يتطابق مع العدد المتوقع، وإذا لم يكن كذلك، يتم رفع استثناء. في النهاية، تعيد الدالة ثلاث قوائم: التوقيعات الجيدة، التوقيعات غير المعروفة، والتوقيعات السيئة.

تُستخدم هذه الدالة في دالة check_multisig، حيث يتم استدعاؤها لتحليل مخرجات GPG بعد التحقق من التوقيعات. يتم تمرير المخرجات الناتجة عن عملية التحقق إلى parse_gpg_result، مما يسمح بتصنيف التوقيعات ومعالجة النتائج بشكل مناسب.

**Note**: من المهم التأكد من أن مخرجات GPG الممررة إلى الدالة تتبع التنسيق المتوقع لضمان دقة التحليل. كما يجب التعامل مع كائنات SigData الناتجة بعناية لضمان دقة المعلومات المستخرجة.

**Output Example**: يمكن أن يبدو مخرجات الكود كالتالي:
```
([SigData(key='ABC123', name='Example Signature', trusted=True, status='valid')],
 [SigData(key='XYZ789', name='Unknown Signature', trusted=False, status='')],
 [SigData(key='DEF456', name='Bad Signature', trusted=False, status='')])
```
### FunctionDef line_begins_with(patt, line)
**line_begins_with**: The function of line_begins_with is التحقق مما إذا كانت السلسلة تبدأ بنمط معين.

**parameters**: The parameters of this Function.
· parameter1: patt - نمط السلسلة الذي سيتم التحقق منه. يجب أن يكون من نوع str.
· parameter2: line - السلسلة التي سيتم فحصها. يجب أن تكون من نوع str.

**Code Description**: هذه الدالة تستخدم للتحقق مما إذا كانت السلسلة المدخلة (line) تبدأ بنمط معين (patt) بعد وجود علامة معينة "[GNUPG:]". يتم استخدام تعبير عادي (regular expression) للقيام بذلك. الدالة تستخدم دالة `re.match` من مكتبة `re` في بايثون، والتي تتحقق مما إذا كانت بداية السلسلة تتطابق مع النمط المحدد. النمط المستخدم هو '^(\[GNUPG:\])\s+' متبوعًا بالنمط المحدد في المتغير `patt`. إذا كانت السلسلة تبدأ بهذا النمط، ستعيد الدالة كائن `re.Match`، وإذا لم تتطابق، ستعيد `None`.

**Note**: يجب التأكد من أن السلسلة المدخلة (line) تحتوي على النص "[GNUPG:]" في بدايتها، وإلا فلن يتم العثور على تطابق. كما يجب أن يكون النمط (patt) مصممًا بشكل صحيح ليتناسب مع ما تبحث عنه.

**Output Example**: إذا كانت السلسلة المدخلة هي "[GNUPG:] هذا هو النص" والنمط هو "هذا هو النص"، ستعيد الدالة كائن `re.Match`، بينما إذا كانت السلسلة هي "هذا هو النص" بدون "[GNUPG:]"، ستعيد `None`.
***
## FunctionDef files_are_equal(filename1, filename2)
**files_are_equal**: The function of files_are_equal is مقارنة محتويات ملفين والتحقق مما إذا كانت متساوية.

**parameters**: The parameters of this Function.
· filename1: اسم الملف الأول الذي سيتم مقارنته.  
· filename2: اسم الملف الثاني الذي سيتم مقارنته.

**Code Description**: تقوم دالة files_are_equal بفتح ملفين وقراءة محتوياتهما بتنسيق ثنائي (binary) للتحقق مما إذا كانت المحتويات متساوية. إذا كانت المحتويات غير متساوية، تقوم الدالة بفتح كلا الملفين مرة أخرى بتنسيق نصي (text) لقراءة الأسطر. بعد ذلك، تستخدم مكتبة difflib لإنشاء فرق (diff) بين الأسطر، وتقوم بتنسيق هذا الفرق باستخدام دالة indent لإضافة مسافة بادئة إلى النص الناتج. يتم تسجيل أي اختلافات باستخدام سجل التحذيرات (log.warning). في النهاية، تعيد الدالة قيمة Boolean تشير إلى ما إذا كانت الملفات متساوية أم لا.

تُستخدم هذه الدالة في سياق دالة أخرى تُدعى get_files_from_hosts_and_compare، والتي تسترجع نفس الملف من عدة مضيفين (hosts) وتتحقق من أن المحتويات متطابقة. بعد استرجاع الملفات، تقوم الدالة بالتحقق من تساوي الملفات باستخدام دالة files_are_equal. إذا كانت الملفات غير متساوية، يتم تسجيل خطأ وإرجاع رمز يدل على عدم تساوي الملفات.

**Note**: يجب التأكد من أن الملفات المدخلة موجودة وقابلة للقراءة، حيث أن محاولة فتح ملفات غير موجودة أو غير قابلة للقراءة ستؤدي إلى حدوث استثناءات.

**Output Example**: إذا كانت الملفات متساوية، ستعيد الدالة القيمة True. وإذا كانت غير متساوية، ستعيد القيمة False، مع تسجيل الاختلافات في السجل.
## FunctionDef get_files_from_hosts_and_compare(hosts, path, filename, require_all)
**get_files_from_hosts_and_compare**: The function of get_files_from_hosts_and_compare is استرجاع نفس الملف من عدد من المضيفين والتأكد من أن محتوياتها متطابقة.

**parameters**: The parameters of this Function.
· hosts: قائمة من عناوين المضيفين (strings) التي سيتم استرجاع الملفات منها.  
· path: المسار الذي يحتوي على الملف المراد استرجاعه.  
· filename: اسم الملف الذي سيتم كتابته محليًا.  
· require_all: قيمة منطقية تحدد ما إذا كان يجب أن يكون جميع المضيفين ناجحين في استرجاع الملف (افتراضي: False).

**Code Description**: تقوم دالة get_files_from_hosts_and_compare باسترجاع ملف معين من مجموعة من المضيفين والتحقق من أن جميع الملفات المسترجعة متطابقة. يتم اعتبار المضيف الأول في القائمة هو "المضيف الرئيسي"، ويجب أن تنجح عملية استرجاع الملف منه. 

تبدأ الدالة بالتحقق من أن هناك أكثر من مضيف واحد. ثم تقوم بتعريف دالة داخلية join_url، التي تقوم بإنشاء عنوان URL للمضيفات عن طريق دمج المضيف مع المسار. بعد ذلك، يتم استرجاع الملف من المضيف الرئيسي باستخدام دالة download_with_wget. إذا فشلت هذه العملية، يتم تسجيل الخطأ وإرجاع رمز الحالة المناسب.

بعد استرجاع الملف من المضيف الرئيسي، تقوم الدالة بمحاولة استرجاع نفس الملف من المضيفين الآخرين. إذا كانت قيمة require_all صحيحة، فإن أي فشل في استرجاع الملف من مضيف آخر سيؤدي إلى تسجيل خطأ وإرجاع رمز الحالة المناسب. إذا كانت القيمة False، فإن الدالة ستقوم بتسجيل تحذير ولكنها ستستمر في العمل.

بعد استرجاع جميع الملفات، تقوم الدالة بمقارنة محتويات الملفات المسترجعة باستخدام دالة files_are_equal. إذا كانت الملفات غير متطابقة، يتم تسجيل خطأ وإرجاع رمز الحالة المناسب. إذا كانت جميع الملفات متطابقة، يتم إرجاع رمز الحالة SUCCESS.

تستخدم هذه الدالة في سياق دالة verify_published_handler، حيث يتم استرجاع ملفات التوقيع وملفات المجموعات من مجموعة من المضيفين والتحقق من سلامتها. تعتبر get_files_from_hosts_and_compare جزءًا أساسيًا من عملية التحقق من الملفات، حيث تضمن أن الملفات المسترجعة من مصادر متعددة متطابقة قبل اتخاذ أي خطوات إضافية.

**Note**: من المهم التأكد من أن المضيفين المحددين متاحين وأن المسار والملف المطلوبين صحيحين لتجنب الأخطاء أثناء عملية الاسترجاع.

**Output Example**: يمكن أن تكون نتيجة الدالة كما يلي:
```python
ReturnCode.SUCCESS
```
### FunctionDef join_url(host)
**join_url**: The function of join_url is دمج عنوان المضيف مع مسار معين بشكل صحيح.

**parameters**: The parameters of this Function.
· parameter1: host - سلسلة نصية تمثل عنوان المضيف الذي سيتم دمجه مع المسار.

**Code Description**: تقوم الدالة join_url بأخذ عنوان مضيف (host) كمدخل، وتقوم بإزالة أي شرطة مائلة (/) من نهاية العنوان باستخدام الدالة rstrip، ثم تضيف شرطة مائلة واحدة، تليها المسار (path) الذي يتم إزالته من أي شرطة مائلة في البداية باستخدام الدالة lstrip. هذا يضمن أن النتيجة النهائية ستكون عنوان URL صحيحًا، حيث يتم دمج المضيف والمسار بشكل متسق دون تكرار الشرط المائل.

**Note**: يجب التأكد من أن المتغير path معرف مسبقًا في السياق الذي يتم فيه استدعاء الدالة join_url، وإلا ستظهر خطأ. كما يجب الانتباه إلى أن الدالة لا تتحقق من صحة عنوان المضيف، لذا يجب التأكد من أن المدخل هو عنوان مضيف صالح.

**Output Example**: إذا كان المدخل host هو "http://example.com" و path هو "/path/to/resource"، فإن النتيجة ستكون "http://example.com/path/to/resource".
***
## FunctionDef check_multisig(sums_file, sigfilename, args)
**check_multisig**: The function of check_multisig is التحقق من صحة التوقيعات المتعددة لملف باستخدام GPG.

**parameters**: The parameters of this Function.
· sums_file: اسم ملف المجموعات الذي يحتوي على البيانات المراد التحقق منها.  
· sigfilename: اسم ملف التوقيع الذي سيتم استخدامه للتحقق من صحة التوقيع.  
· args: كائن يحتوي على خيارات إضافية مثل مستوى التفاصيل (verbose) ومفتاح الخادم (keyserver).

**Code Description**: تقوم دالة check_multisig بالتحقق من صحة التوقيعات المتعددة باستخدام أداة GPG. تبدأ الدالة باستدعاء دالة verify_with_gpg للتحقق من صحة ملف المجموعات باستخدام ملف التوقيع. يتم التقاط كود الإرجاع والناتج من GPG. إذا كانت خيارات verbose مفعلة، يتم تسجيل مخرجات GPG لتسهيل تتبع الأخطاء.

بعد ذلك، يتم تحليل الناتج باستخدام دالة parse_gpg_result، التي تقوم بتصنيف التوقيعات إلى ثلاث فئات: التوقيعات الجيدة (good signatures)، التوقيعات غير المعروفة (unknown signatures)، والتوقيعات السيئة (bad signatures). إذا كانت هناك توقيعات غير معروفة وكان الخيار لاسترداد المفاتيح مفعلاً، يتم طلب إذن المستخدم لاسترداد المفاتيح المفقودة باستخدام دالة prompt_yn. إذا وافق المستخدم، يتم استرداد المفتاح باستخدام أمر gpg.

بعد استرداد المفاتيح، يتم إعادة التحقق من التوقيعات مرة أخرى. في النهاية، تعيد الدالة كود الإرجاع، الناتج، والتوقيعات المصنفة.

تُستخدم دالة check_multisig في دالة verify_shasums_signature، حيث يتم استدعاؤها للتحقق من صحة التوقيعات قبل اتخاذ قرار بشأن سلامة البيانات. إذا كان كود الإرجاع غير مقبول، يتم تسجيل الأخطاء المناسبة وإرجاع حالة الفشل. 

**Note**: يجب التأكد من أن GPG مثبتة ومهيأة بشكل صحيح على النظام، وأن الملفات المقدمة موجودة وقابلة للوصول. كما يجب التعامل مع المدخلات بعناية لضمان دقة النتائج.

**Output Example**: قد يكون الناتج من الدالة على الشكل التالي:
```
(0, "gpg: Signature made ...\ngpg: Good signature from ...", 
 [SigData(key='ABC123', name='Example Signature', trusted=True, status='valid')],
 [SigData(key='XYZ789', name='Unknown Signature', trusted=False, status='')],
 [SigData(key='DEF456', name='Bad Signature', trusted=False, status='')])
```
## FunctionDef prompt_yn(prompt)
**prompt_yn**: The function of prompt_yn is إرجاع قيمة صحيحة إذا أدخل المستخدم 'y'.

**parameters**: المعلمات الخاصة بهذه الدالة.
· prompt: نص الرسالة الذي سيتم عرضه للمستخدم عند الطلب.

**Code Description**: تقوم دالة prompt_yn بطلب إدخال من المستخدم، حيث تعرض رسالة محددة (المعلمة prompt) وتنتظر حتى يقوم المستخدم بإدخال إما 'y' أو 'n'. يتم تحويل الإدخال إلى أحرف صغيرة لضمان عدم التأثر بحالة الأحرف. إذا كان الإدخال غير صحيح (أي ليس 'y' أو 'n')، تستمر الدالة في الطلب من المستخدم حتى يتم إدخال قيمة صحيحة. في النهاية، تعيد الدالة قيمة صحيحة (True) إذا كان الإدخال هو 'y'، وقيمة خاطئة (False) إذا كان الإدخال هو 'n'.

تستخدم هذه الدالة في دالة أخرى تُدعى check_multisig، والتي تتحقق من التوقيعات. في حالة وجود مفاتيح غير معروفة، يتم استخدام prompt_yn لطلب إذن المستخدم لاسترداد المفتاح المفقود. إذا أجاب المستخدم بـ 'y'، يتم تنفيذ أمر لاسترداد المفتاح باستخدام gpg. هذا يوضح كيف أن prompt_yn تلعب دورًا حيويًا في تحسين تجربة المستخدم من خلال توفير وسيلة للتفاعل مع المستخدم في سياق التحقق من التوقيعات.

**Note**: يجب على المطورين التأكد من أن الإدخال من المستخدم يتوافق مع القيم المتوقعة ('y' أو 'n')، حيث أن أي إدخال آخر سيؤدي إلى حلقة لا نهائية حتى يتم إدخال قيمة صحيحة.

**Output Example**: إذا أدخل المستخدم 'y'، ستعيد الدالة القيمة True. إذا أدخل المستخدم 'n'، ستعيد الدالة القيمة False.
## FunctionDef verify_shasums_signature(signature_file_path, sums_file_path, args)
**verify_shasums_signature**: The function of verify_shasums_signature is التحقق من صحة التوقيعات لملف SHA256SUMS باستخدام GPG.

**parameters**: The parameters of this Function.
· signature_file_path: مسار ملف التوقيع الذي يحتوي على التوقيعات المراد التحقق منها.  
· sums_file_path: مسار ملف المجموعات الذي يحتوي على البيانات المراد التحقق منها.  
· args: كائن يحتوي على خيارات إضافية مثل عدد التوقيعات الجيدة المطلوبة ومفتاح الخادم.

**Code Description**: تقوم دالة verify_shasums_signature بالتحقق من صحة التوقيعات المرتبطة بملف SHA256SUMS. تبدأ الدالة بتحديد الحد الأدنى من التوقيعات الجيدة المطلوبة من خلال المتغير min_good_sigs، وتحدد رموز الخروج المسموح بها من GPG. يتم استدعاء دالة check_multisig للتحقق من صحة التوقيعات، والتي تعيد كود الإرجاع، الناتج، والتوقيعات المصنفة إلى جيدة وغير معروفة وسيئة.

إذا كان كود الإرجاع غير مقبول، يتم تسجيل الأخطاء المناسبة وإرجاع حالة الفشل. يتم بعد ذلك تحديد المفاتيح الموثوقة بناءً على المدخلات المقدمة، ويتم حساب عدد التوقيعات الجيدة الموثوقة وغير الموثوقة. إذا كان عدد التوقيعات الجيدة أقل من الحد الأدنى المطلوب، يتم تسجيل تحذيرات وإرجاع حالة عدم كفاية التوقيعات الجيدة.

تقوم الدالة أيضًا بتسجيل معلومات حول التوقيعات الجيدة، التوقيعات المنتهية، والتوقيعات السيئة وغير المعروفة. في النهاية، تعيد الدالة كود الإرجاع مع قوائم التوقيعات الجيدة الموثوقة وغير الموثوقة، والتوقيعات غير المعروفة والسيئة.

تُستخدم هذه الدالة في دوال أخرى مثل verify_published_handler وverify_binaries_handler، حيث يتم استدعاؤها للتحقق من صحة التوقيعات قبل اتخاذ أي إجراءات إضافية. تعتمد هذه الدوال على نتائج verify_shasums_signature لتحديد ما إذا كانت البيانات موثوقة أم لا.

**Note**: من المهم التأكد من أن جميع المدخلات صحيحة وأن GPG مثبتة بشكل صحيح على النظام. يجب التعامل مع التوقيعات بعناية لضمان دقة النتائج.

**Output Example**: قد يبدو الناتج من الدالة كالتالي:
```
(ReturnCode.SUCCESS, 
 [SigData(key='ABC123', name='Example Signature', trusted=True, status='valid')], 
 [SigData(key='XYZ789', name='Untrusted Signature', trusted=False, status='')], 
 [SigData(key='DEF456', name='Unknown Signature', trusted=False, status='')], 
 [SigData(key='GHI789', name='Bad Signature', trusted=False, status='')])
```
## FunctionDef parse_sums_file(sums_file_path, filename_filter)
**parse_sums_file**: The function of parse_sums_file is استخراج التجزئات وأسماء الملفات الثنائية للتحقق منها من ملف التجزئة.

**parameters**: The parameters of this Function.
· parameter1: sums_file_path - مسار ملف التجزئات الذي يحتوي على التجزئات وأسماء الملفات الثنائية.
· parameter2: filename_filter - قائمة بأسماء الملفات الثنائية المراد تصفيتها.

**Code Description**: تقوم دالة parse_sums_file بفتح ملف التجزئات المحدد بواسطة sums_file_path وقراءة محتوياته. كل سطر في الملف يجب أن يحتوي على تجزئة واسم ملف ثنائي مفصولين بمسافة. تقوم الدالة بتصفية النتائج بناءً على قائمة filename_filter، حيث إذا كانت القائمة فارغة، سيتم إرجاع جميع السطور. إذا كانت تحتوي على أسماء ملفات، سيتم إرجاع السطور التي تحتوي على أي من هذه الأسماء. يتم استخدام هذه الدالة في سياق دالتين أخريين: verify_published_handler و verify_binaries_handler. في الدالة verify_published_handler، يتم استدعاء parse_sums_file لاستخراج التجزئات والأسماء من ملف SUMS_FILENAME، حيث يتم استخدام os_filter لتصفية النتائج. بينما في verify_binaries_handler، يتم استخدامها لاستخراج التجزئات والأسماء من ملف محدد بواسطة args.sums_file، مع تصفية النتائج بناءً على الملفات الثنائية المحددة من قبل المستخدم. 

**Note**: يجب التأكد من أن ملف التجزئات موجود في المسار المحدد وأنه يتبع التنسيق الصحيح، حيث أن أي خطأ في التنسيق قد يؤدي إلى نتائج غير صحيحة أو عدم العثور على الملفات المطلوبة.

**Output Example**: 
إذا كان ملف التجزئات يحتوي على السطور التالية:
```
abc123 binary1
def456 binary2
ghi789 binary3
```
وتم تمرير قائمة filename_filter تحتوي على ['binary1', 'binary3']، فإن الدالة ستعيد:
```
[['abc123', 'binary1'], ['ghi789', 'binary3']]
```
## FunctionDef verify_binary_hashes(hashes_to_verify)
**verify_binary_hashes**: وظيفة verify_binary_hashes هي التحقق من تطابق تجزئات الملفات الثنائية مع القيم المتوقعة.

**parameters**: المعلمات لهذه الوظيفة.
· hashes_to_verify: قائمة من القوائم تحتوي على تجزئات الملفات الثنائية المتوقعة وأسماء الملفات الثنائية للتحقق منها.

**Code Description**: تقوم وظيفة verify_binary_hashes بالتحقق من صحة تجزئات الملفات الثنائية. تأخذ هذه الوظيفة قائمة من القوائم، حيث يحتوي كل عنصر على تجزئة متوقعة واسم ملف ثنائي. تقوم الوظيفة بفتح كل ملف ثنائي وقراءة محتوياته، ثم تحسب التجزئة باستخدام خوارزمية SHA-256. إذا كانت التجزئة المحسوبة لا تتطابق مع التجزئة المتوقعة، يتم إضافة اسم الملف إلى قائمة الملفات المخالفة. إذا كانت جميع التجزئات متطابقة، يتم تخزين أسماء الملفات والتجزئات المحسوبة في قاموس.

تستخدم هذه الوظيفة رموز الحالة من فئة ReturnCode لتحديد نتيجة العملية. إذا كانت هناك ملفات مخالفة، يتم تسجيل رسالة خطأ حرجة تحتوي على أسماء الملفات المخالفة، وتعيد الوظيفة رمز الحالة INTEGRITY_FAILURE. إذا كانت جميع التجزئات متطابقة، تعيد الوظيفة رمز الحالة SUCCESS مع قاموس يحتوي على أسماء الملفات والتجزئات المحسوبة.

تُستدعى هذه الوظيفة من قبل كل من verify_published_handler و verify_binaries_handler، حيث يتم استخدامها للتحقق من صحة التجزئات بعد تحميل الملفات الثنائية. في verify_published_handler، يتم استدعاء verify_binary_hashes بعد تحميل الملفات الثنائية من مضيفين مختلفين، بينما في verify_binaries_handler، يتم استدعاءها بعد التحقق من صحة ملف التجزئات SHA256SUMS. في كلا الحالتين، تساهم verify_binary_hashes في ضمان سلامة الملفات الثنائية التي يتم التعامل معها.

**Note**: من المهم التأكد من أن الملفات الثنائية التي يتم التحقق منها موجودة وأن التجزئات المتوقعة صحيحة، حيث أن أي خطأ في هذه العملية قد يؤدي إلى فشل في التحقق من سلامة الملفات.

**Output Example**: 
(ReturnCode.SUCCESS, {'file1.bin': 'abc123...', 'file2.bin': 'def456...'})
## FunctionDef verify_published_handler(args)
**verify_published_handler**: The function of verify_published_handler is التحقق من صحة التوقيعات والملفات الثنائية لإصدار محدد من برنامج Bitcoin.

**parameters**: The parameters of this Function.
· args: كائن من نوع argparse.Namespace يحتوي على المعلمات المدخلة من سطر الأوامر، بما في ذلك إصدار Bitcoin المراد التحقق منه وخيارات إضافية مثل التنظيف وإلزام جميع المضيفين.

**Code Description**: تقوم دالة verify_published_handler بتنفيذ عملية التحقق من صحة التوقيعات والملفات الثنائية لإصدار محدد من برنامج Bitcoin. تبدأ الدالة بتحديد دليل العمل المؤقت الذي سيتم استخدامه لتخزين الملفات المؤقتة. يتم تنفيذ عملية تنظيف في حالة الحاجة، حيث يتم حذف الملفات المؤقتة بعد الانتهاء من العملية.

تقوم الدالة أولاً بتحليل سلسلة الإصدار المدخلة باستخدام دالة parse_version_string، حيث يتم استخراج المعلومات الأساسية مثل الإصدار الأساسي، وإصدار المرشح (إذا كان موجودًا)، ونظام التشغيل. إذا كانت سلسلة الإصدار غير صحيحة، يتم تسجيل خطأ وإرجاع رمز الحالة BAD_VERSION.

بعد ذلك، يتم تحديد المسارات البعيدة للملفات التي سيتم التحقق منها، بما في ذلك ملفات التوقيع وملفات المجموعات (SUMS). يتم استخدام دالة get_files_from_hosts_and_compare لاسترجاع هذه الملفات من مجموعة من المضيفين والتحقق من تطابقها. إذا فشلت هذه العملية، يتم إرجاع رمز الحالة المناسب.

تتطلب عملية التحقق من صحة التوقيعات أن يكون الإصدار 22.0 أو أعلى، حيث يتم التحقق من صحة التوقيعات باستخدام دالة verify_shasums_signature. إذا كانت التوقيعات غير صحيحة، يتم تنفيذ عملية التنظيف وإرجاع رمز الحالة INTEGRITY_FAILURE.

بعد التحقق من صحة التوقيعات، يتم استخراج التجزئات وأسماء الملفات الثنائية باستخدام دالة parse_sums_file. إذا لم تتطابق أي من الملفات الثنائية مع النظام المحدد، يتم إرجاع رمز الحالة NO_BINARIES_MATCH.

تقوم الدالة بعد ذلك بتنزيل الملفات الثنائية المطلوبة والتحقق من تطابق تجزئاتها باستخدام دالة verify_binary_hashes. إذا كانت جميع التجزئات متطابقة، يتم إرجاع رمز الحالة SUCCESS، مع إمكانية عرض النتائج بتنسيق JSON إذا تم تحديد ذلك في المعلمات.

تستدعي هذه الدالة من دالة main، حيث يتم تعيينها كوظيفة افتراضية عند استخدام الأمر "pub" للتحقق من إصدار منشور. يتم تمرير المعلمات المدخلة من سطر الأوامر إلى verify_published_handler، مما يتيح للمستخدمين التحقق من إصدارات مختلفة من برنامج Bitcoin بسهولة.

**Note**: من المهم التأكد من أن جميع المدخلات صحيحة وأن النظام يحتوي على الأدوات اللازمة مثل wget وGPG، حيث تعتمد الدالة على هذه الأدوات لتنفيذ عمليات التحميل والتحقق.

**Output Example**: قد يبدو الناتج من الدالة كالتالي:
```
{
  "good_trusted_sigs": ["sig1", "sig2"],
  "good_untrusted_sigs": ["sig3"],
  "unknown_sigs": ["sig4"],
  "bad_sigs": ["sig5"],
  "verified_binaries": ["binary1", "binary2"]
}
```
### FunctionDef cleanup
**cleanup**: وظيفة cleanup هي تنظيف الملفات وإزالة الدليل العامل.

**parameters**: لا توجد معلمات لهذه الوظيفة.

**Code Description**: تقوم وظيفة cleanup بتنفيذ عدة خطوات لتنظيف الملفات. أولاً، تسجل رسالة معلوماتية باستخدام log.info تشير إلى بدء عملية التنظيف. بعد ذلك، تقوم بتغيير الدليل الحالي إلى الدليل الرئيسي للمستخدم باستخدام os.chdir(Path.home()). وأخيرًا، تقوم بإزالة الدليل العامل المحدد بواسطة WORKINGDIR باستخدام shutil.rmtree، مما يؤدي إلى حذف جميع الملفات والمجلدات الموجودة فيه بشكل نهائي.

**Note**: من المهم التأكد من أن WORKINGDIR يحتوي على الملفات التي يمكن حذفها، حيث أن استخدام shutil.rmtree سيؤدي إلى فقدان البيانات بشكل دائم. يجب استخدام هذه الوظيفة بحذر، خاصة في بيئات الإنتاج.
***
## FunctionDef verify_binaries_handler(args)
**verify_binaries_handler**: The function of verify_binaries_handler is التحقق من صحة الثنائيات المحلية باستخدام ملف SHA256SUMS والتوقيع المرتبط به.

**parameters**: The parameters of this Function.
· args: كائن يحتوي على خيارات المستخدم، بما في ذلك مسارات الملفات الثنائية وملف SHA256SUMS وملف التوقيع.

**Code Description**: تقوم دالة verify_binaries_handler بمعالجة التحقق من صحة الثنائيات المحلية من خلال عدة خطوات. أولاً، يتم إنشاء قاموس binary_to_basename لتخزين أسماء الملفات الثنائية مع مساراتها. بعد ذلك، يتم تحديد مسار ملف التوقيع (sums_sig_file) إما من المدخلات أو يتم افتراضه بناءً على ملف sums_file. 

تقوم الدالة بعد ذلك بالتحقق من صحة التوقيع على ملف SHA256SUMS باستخدام دالة verify_shasums_signature، والتي تعيد رموز الحالة والتوقيعات الجيدة وغير المعروفة والسيئة. إذا كانت حالة التوقيع غير ناجحة، يتم إرجاع رمز الحالة المناسب.

بعد ذلك، يتم استخراج التجزئات والأسماء من ملف sums_file باستخدام دالة parse_sums_file، حيث يتم تصفية النتائج بناءً على الملفات الثنائية المحددة. إذا لم تتطابق أي من الملفات، يتم تسجيل خطأ وإرجاع رمز الحالة NO_BINARIES_MATCH.

تتحقق الدالة بعد ذلك من أن جميع الملفات موجودة، وإذا كانت هناك ملفات مفقودة، يتم تسجيلها. يتم استخدام دالة verify_binary_hashes للتحقق من تطابق التجزئات المحسوبة مع القيم المتوقعة. إذا كانت هناك أي مشاكل في التحقق من التجزئات، يتم إرجاع رمز الحالة المناسب.

إذا تم تحديد خيار الإخراج بصيغة JSON، يتم طباعة النتائج بتنسيق JSON، وإلا يتم طباعة أسماء الملفات التي تم التحقق منها وأي ملفات مفقودة. في النهاية، تعيد الدالة رمز الحالة SUCCESS إذا تمت جميع العمليات بنجاح.

تُستدعى هذه الدالة من دالة main، حيث يتم تحديدها كأحد الأوامر الفرعية للتحقق من الثنائيات المحلية. يتم تمرير كائن args الذي يحتوي على جميع الخيارات المحددة من قبل المستخدم.

**Note**: من المهم التأكد من أن جميع الملفات المطلوبة موجودة وأنها تتبع التنسيق الصحيح، حيث أن أي خطأ في هذه العملية قد يؤدي إلى فشل في التحقق من صحة الثنائيات.

**Output Example**: قد يبدو الناتج من الدالة كالتالي:
```
VERIFIED: binary1
VERIFIED: binary2
MISSING: binary3
```
## FunctionDef main
**main**: The function of main is إعداد وتحليل خيارات سطر الأوامر لتحديد كيفية التحقق من صحة التوقيعات والملفات الثنائية.

**parameters**: The parameters of this Function.
· args: كائن يحتوي على خيارات المستخدم المدخلة من سطر الأوامر، والتي تحدد كيفية تنفيذ البرنامج.

**Code Description**: تقوم دالة main بإنشاء محلل خيارات سطر الأوامر باستخدام مكتبة argparse. يتم تعريف مجموعة من الخيارات التي يمكن للمستخدم تحديدها عند تشغيل البرنامج، مثل وضع verbose أو quiet، واستيراد المفاتيح، والحد الأدنى من التوقيعات الجيدة المطلوبة، ومعلومات حول خادم المفاتيح، والمفاتيح الموثوقة، وإخراج النتائج بتنسيق JSON.

تقوم الدالة أيضًا بإنشاء مجموعة من الأوامر الفرعية، حيث يتم تعريف أمرين رئيسيين: "pub" و "bin". يتم تعيين كل أمر إلى دالة معالجة محددة، حيث يتم استدعاء verify_published_handler عند استخدام الأمر "pub" للتحقق من إصدار منشور، و verify_binaries_handler عند استخدام الأمر "bin" للتحقق من الثنائيات المحلية.

بعد تحليل الخيارات، يتم تحديد مستوى السجل بناءً على ما إذا كان الخيار quiet قد تم تحديده. إذا كان محددًا، يتم ضبط مستوى السجل على تحذير فقط.

في النهاية، يتم استدعاء الدالة المحددة بناءً على الأمر المدخل، ويتم تمرير كائن args الذي يحتوي على جميع الخيارات المحددة. هذا يسمح للمستخدمين بتخصيص سلوك البرنامج بناءً على احتياجاتهم، مما يسهل عملية التحقق من صحة التوقيعات والملفات الثنائية.

**Note**: من المهم التأكد من أن جميع المدخلات صحيحة وأن الخيارات المحددة تتوافق مع المتطلبات، حيث أن أي خطأ في هذه المدخلات قد يؤدي إلى نتائج غير صحيحة أو فشل في التحقق.

**Output Example**: قد يبدو الناتج من الدالة كالتالي:
```
{
  "command": "pub",
  "version": "0.21.0",
  "cleanup": true,
  "require_all_hosts": false,
  "json": true
}
```
